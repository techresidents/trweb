{% extends "menu_base.html" %}
{% load url from future %}
{% load verbatim %}

{% block title %}Tech Residents Chat{% endblock %}

{% block extrahead %}
<link href="{{STATIC_URL}}css/chat.css" rel="stylesheet">

<style type="text/css">
    {% for user in users %}
    .user{{user.id}} {
        color: {% cycle '#00A651' '#00AEEF' '#F15A29' '#231F20' as usercolor %};
    }
    
    .user{{user.id}}-border {
        border-style: solid;
        border-color: {{ usercolor }};
        border-width: 5px;
    }
    {% endfor %}
</style>

<script src="http://staging.tokbox.com/v0.91/js/TB.min.js" ></script>

<script>
    var require = {
        baseUrl: '/static/js',
    };
</script>
<script data-main="{{STATIC_URL}}js/apps/chat/main.js" src="{{STATIC_URL}}js/3ps/require/require.js"></script>
{% endblock %}

{% block content %}

<div class="container" id="chatapp">
    <div class="row" id="chat"></div>
    <div class="row">
        <div id="discuss"class="span12 page-header">
        </div>
    </div>
    <div class="row">
        <div id="tagger" class="span12 page-header">
        </div>
    </div>
    <div class="row">
    </div>
    <div class="row">
        <div class="span12">
            <ul class="nav nav-tabs">
                <li class="active" ><a data-toggle="tab" href="#agenda">Agenda</a></li>
                <li><a data-toggle="tab" href="#tags">Tags</a></li>
                <li><a data-toggle="tab" href="#whiteboard">Whiteboard</a></li>
                <li><a data-toggle="tab" href="#resource">Resource</a></li>
            </ul>
            <div class="tab-content">
                <div id="agenda" class="tab-pane fade in active">
                    <div id="agenda-control" class="span10"></div>
                    <div>
                        <div class="span5">
                            <ul/>
                        </div>
                        <div id="agenda-detail" class="span5"></div>
                    </div>
                </div>
                <div id="tags" class="tab-pane fade">
                    <h5>Tags</h5>
                    <select></select>
                    <ul id="taglist"/>
                </div>
                <div id="whiteboard" class="span10 well tab-pane fade">
                    <div id="whiteboard-container">
                    </div>
                </div>
                <div id="resource" class="tab-pane fade">
                    <!--
                    <h5>Resource</h5>
                    <iframe src="http://localhost:8000/document/embed/1?width=800&height=600" style="width: 1024px; height: 768px;" frameborder="0"></iframe>
                    -->
                </div>
            </div>
        </div>
    </div>
</div>


<!-- All of these data structures are generated on the server w/out user input, so it's safe -->
{% autoescape off %}
<script>
    TR = { XD: { remote: "{{TR_XD_REMOTE}}" } };

    data =  {
        chatAPIKey: "{{chat_api_key}}",
        chatSessionToken: "{{chat_session_token}}",
        chatUserToken: "{{chat_user_token}}",
        users: {{users_json}},
        topics: {{topics_json}}
    };
</script>
{% endautoescape %}

<!-- Templates -->

<script type="text/template" id="chat-user-header-template">
</script>

<script type="text/template" id="chat-user-template">
    <div class="user<%= id %>-border chat-user-container" style="width: 300px; height: 225px;">
        <div id="user<%= id %>">
            <img style="height: 225px;" src="{{STATIC_URL}}img/person.jpg"/>
        </div>
    </div>
</script>

<script type="text/template" id="chat-user-footer-template">
    <p>Connected: <%= isConnected %> </p>
    <p>Publishing: <%= isPublishing %> </p>
</script>

<script type="text/template" id="tag-item-template">
    <a class="user<%= userId %>" href="#"><%= name %></a>
    <% if(myTag) { %>
        <a class="close-inline destroy">x</a>
    <% } %>
    <span>by <%= user.name %> at <%= time %> </span>
</script>

<script type="text/template" id="tag-topic-select-template">
    <%_.each(topics, function(topic) { %>
        <option class="level<%= topic.level %>" value="<%=topic.id%>"><%=topic.title%></option>
    <% }); %>
</script>

<script type="text/template" id="discuss-template">
    <div class="span1">
        <h3>Discuss</h3>
    </div>
    <div class="span7">
        <h3><%= root.title %>: <%= title %></h3>
    </div>
    <button class="btn btn-input next">Next</button>
    <span id="discuss-timer"/>
</script>

<script type="text/template" id="tagger-template">
    <div class="span1">
        <h3>Tag</h3>
    </div>
    <div class="span8">
        <div>
            <input class="span7">
            <button class="btn btn-input add">Add</button>
            <span><strong>Recent Tags</strong>
                <ul/>
            </span>
        </div>
    </div>
</script>

<script type="text/template" id="tagger-item-template">
    <a class="user<%= userId %>" rel="tooltip" href="#" title="by <%= user.name %> at <%= time %>"><%= name %></a>
    <% if(myTag) { %>
        <a class="close-inline destroy">x</a>
    <% } %>
</script>

<script type="text/template" id="agenda-item-template">
    <div class="level<%= level %>">
        <%= title %>
    </div>
</script>

<script type="text/template" id="agenda-detail-template">
    <h3><%= title %>: <small><%= durationFormat %><small></h3>
    <p><%= description %></p>
</script>

<script type="text/template" id="agenda-control-template">
    <h3><%= title %>
        <button class="btn btn-input next">Next</button>
        <span id="agenda-control-timer"></span>
    </h3>
</script>


{% endblock %}
