define("text!playback/templates/minute.html",[],function(){return'<h3>\n    <% if(playing) { %>\n    <a><i class="player-btn player-speaker"></i></a>\n    <% } else { %>\n    <a class="play"><i class="player-btn player-play"></i></a>\n    <% } %>\n    <%=minute.topic.title %>\n    <% if(minute.duration < 60) { %>\n        <small> (<%= minute.duration %> sec)</small>\n    <% } else { %>\n        <small> (<%= fmt.format(minute.duration / 60, \'n0\') %> min)</small>\n    <% } %>\n</h3>\n<div class="description">\n    <p><%= minute.topic.description %></p>\n</div>\n'}),define("text!playback/templates/minutes.html",[],function(){return""}),define("text!playback/templates/playback.html",[],function(){return'<div class="page-header"><h3>Take a listen</h3></div>\n<div class="span6 playback-minutes"></div>\n<div class="span2 offset1">\n    <div class="playback-users"></div>\n    <div class="playback-tags"></div>\n</div>\n'}),define("text!playback/templates/tag.html",[],function(){return"<span rel=\"tooltip\" title=\"Tagged by <%= user_id %> <%= chat_minute.topic ? ' in ' + chat_minute.topic.title : ''%>\"><%= name %>,</span> \n"}),define("text!playback/templates/tags.html",[],function(){return"<% if(collection.length) { %>\n<h3>Tags</h3>\n<% } %>\n"}),define("text!playback/templates/user.html",[],function(){return'<a href="/e/user/<%=id%>">\n    <div class="user-logo"></div>\n    <p><small><%=id%></small></p>\n</a>\n'}),define("text!playback/templates/users.html",[],function(){return"<h3>Participants</h3>\n"}),define("playback/views",["jquery","jquery.bootstrap","underscore","core","api","text!./templates/minute.html","text!./templates/minutes.html","text!./templates/playback.html","text!./templates/tag.html","text!./templates/tags.html","text!./templates/user.html","text!./templates/users.html"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h={PLAY:"playback:Play",PAUSE:"playback:Pause"},p=r.view.View.extend({initialize:function(e){this.template=n.template(a),this.participant=e.participant,this.listenTo(this.model,"change",this.render)},render:function(){var e=this.model.toJSON({withRelated:["chat_minute__topic"]});return this.$el.html(this.template(e)),this.$el.addClass("playback-tag"),this.$el.addClass("participant"+this.participant),this.$("[rel=tooltip]").tooltip(),this}}),d=r.view.View.extend({initialize:function(e){this.template=n.template(f),this.users=e.users,this.listenTo(this.collection,"reset",this.onReset),this.listenTo(this.collection,"add",this.onAdd),this.childViews=[],this.initChildViews()},initChildViews:function(){this.destroyChildViews(),this.childViews=[],this.collection.each(this.createChildView,this)},createChildView:function(e){var t=this.users.get(e.get_user_id()),n=(new p({model:e,participant:this.users.indexOf(t)+1})).render();return this.childViews.push(n),n},render:function(){var e={collection:this.collection.toJSON()};return this.$el.html(this.template(e)),n.each(this.childViews,function(e){this.append(e)},this),this},onReset:function(){this.initChildViews(),this.render()},onAdd:function(e){var t=this.createChildView(e);this.append(t)}}),v=r.view.View.extend({initialize:function(e){this.template=n.template(l),this.participant=e.participant,this.listenTo(this.model,"change",this.render)},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this.$el.addClass("playback-user"),this.$el.addClass("participant"+this.participant),this}}),m=r.view.View.extend({initialize:function(e){this.template=n.template(c),this.listenTo(this.collection,"reset",this.onReset),this.listenTo(this.collection,"add",this.onAdd),this.childViews=[],this.initChildViews()},initChildViews:function(){this.destroyChildViews(),this.childViews=[],this.collection.each(this.createChildView,this)},createChildView:function(e){var t=(new v({model:e,participant:this.collection.indexOf(e)+1})).render();return this.childViews.push(t),t},render:function(){return this.$el.html(this.template()),n.each(this.childViews,function(e){this.append(e)},this),this},onReset:function(){this.initChildViews(),this.render()},onAdd:function(e){var t=this.createChildView(e);this.append(t)}}),g=r.view.View.extend({events:{"click .play":"play","click .pause":"pause"},initialize:function(e){this.template=n.template(s),this.playerState=e.playerState,this.listenTo(this.model,"change",this.render),this.listenTo(this.playerState,"change:chatMinute",this.render),this.listenTo(this.playerState,"change:state",this.render)},isPlaying:function(){var e=!1,t=this.playerState.chatMinute();return t&&t.id===this.model.id&&(e=this.playerState.isPlaying()),e},render:function(){var e={minute:this.model.toJSON({withRelated:["topic"]}),playing:this.isPlaying(),fmt:this.fmt};return e.minute.duration=(this.model.get_end()-this.model.get_start())/1e3,this.$el.html(this.template(e)),this.$el.addClass("playback-minute"),this.$el.addClass("level"+this.model.get_topic().get_level()),this},play:function(e){var t={chatSession:this.model.get_chat_session(),chatMinute:this.model};this.triggerEvent(h.PLAY,t)},pause:function(e){this.triggerEvent(h.PAUSE)}}),y=r.view.View.extend({initialize:function(e){this.template=n.template(o),this.playerState=e.playerState,this.listenTo(this.collection,"reset",this.onReset),this.listenTo(this.collection,"add",this.onAdd),this.childViews=[],this.initChildViews()},initChildViews:function(){this.destroyChildViews(),this.childViews=[],this.collection.each(this.createChildView,this)},createChildView:function(e){var t=(new g({model:e,playerState:this.playerState})).render();return this.childViews.push(t),t},render:function(){return this.$el.html(this.template()),n.each(this.childViews,function(e){this.append(e)},this),this},onReset:function(){this.initChildViews(),this.render()},onAdd:function(e){var t=this.createChildView(e);this.append(t)}}),b=r.view.View.extend({events:{"playback:Play":"play"},childViews:function(){return[this.minutesView,this.usersView,this.tagsView]},initialize:function(e){this.template=n.template(u),this.playerState=e.playerState,this.modelWithRelated=["chat__topic__tree","chat_minutes","users","chat_tags"],this.listenTo(this.model,"change",this.render),this.loader=new i.loader.ApiLoader([{instance:this.model,withRelated:this.modelWithRelated}]),this.loader.load(),this.minutesView=null,this.usersView=null,this.tagsView=null,this.initChildViews()},initChildViews:function(){this.minutesView=new y({collection:this.model.get_chat_minutes(),playerState:this.playerState}),this.usersView=new m({collection:this.model.get_users()}),this.tagsView=new d({collection:this.model.get_chat_tags(),users:this.model.get_users()})},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this.assign(this.minutesView,".playback-minutes"),this.assign(this.usersView,".playback-users"),this.assign(this.tagsView,".playback-tags"),this},play:function(e,t){t.chatSession=this.model}});return{EVENTS:h,PlaybackView:b}}),define("playback/mediators",["underscore","notifications","core","api","ctrl","./views"],function(e,t,n,r,i,s){var o=n.mediator.Mediator.extend({name:function(){return o.NAME},viewType:function(){return o.VIEW_TYPE},notifications:[[t.VIEW_CREATE,"onCreateView"],[t.VIEW_DESTROY,"onDestroyView"]],initialize:function(e){this.view=null,this.playerStateProxy=this.facade.getProxy(i.proxies.player.PlayerStateProxy.NAME)},onCreateView:function(e){if(e.type===this.viewType()){var n=new r.models.ChatSession({id:e.options.id});this.view=new s.PlaybackView({model:n,playerState:this.playerStateProxy.model}),this.view.addEventListener(this.cid,s.EVENTS.PLAY,this.onPlay,this),this.view.addEventListener(this.cid,s.EVENTS.PAUSE,this.onPause,this),this.facade.trigger(t.VIEW_CREATED,{type:this.viewType(),view:this.view,options:e.options})}},onDestroyView:function(e){e.type===this.viewType()&&(e.view.destroy(),this.facade.trigger(t.VIEW_DESTROYED,{type:this.viewType(),view:e.view}),this.view===e.view&&(this.view=null))},onPlay:function(e,n){var r={chatSession:n.chatSession,chatMinute:n.chatMinute};this.facade.trigger(t.PLAYER_PLAY,r)},onPause:function(e,n){this.facade.trigger(t.PLAYER_PAUSE)}},{NAME:"PlaybackMediator",VIEW_TYPE:"PlaybackView"});return{PlaybackMediator:o}}),define("playback/main",["core","./mediators","./views"],function(e,t,n){var r=function(e){e.registerMediator(new t.PlaybackMediator)};return e.facade.register(r),{mediators:t,views:n}}),define("playback",["playback/main"],function(e){return e});