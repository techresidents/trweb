/**
 * Copyright (c) 2011 Felix Gnass [fgnass at neteye dot de]
 * Licensed under the MIT license
 */

define("ui/events/type",[],function(){return{SHOW:"show",HIDE:"show",ENABLE:"enable",DISABLE:"disable",HIGHLIGHT:"highlight",UNHIGHLIGHT:"unhighlight",ACTIVATE:"activate",DEACTIVATE:"deactivate",SELECT:"select",UNSELECT:"unselect",CHECK:"check",UNCHECK:"uncheck",OPEN:"open",CLOSE:"close",CHANGE:"change"}}),define("ui/events/keycodes",[],function(){return{BACKSPACE:8,TAB:9,ENTER:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40}}),define("ui/input/views",["jquery","underscore","backbone","core","../events/type","../events/keycodes"],function(e,t,n,r,i,s){var o={CHANGE:i.CHANGE,ENTER_KEY:"enterkey"},u=r.view.View.extend({initialize:function(e){e=t.extend({throttle:150,trim:!0,updateDuringTyping:!1,preventDefaultOnEnter:!0,blurOnEnter:!0},e),this.throttle=e.throttle,this.model=e.model,this.modelAttribute=e.modelAttribute,this.trim=e.trim,this.updateDuringTyping=e.updateDuringTyping,this.preventDefaultOnEnter=e.preventDefaultOnEnter,this.blurOnEnter=e.blurOnEnter,this._lastInputValue="",this._timer=null,this.setModel(e.model,e.modelAttribute),this.setInput(e.inputView,e.inputSelector)},delegateInputEvents:function(){this.inputView&&(this.undelegateInputEvents(),this.inputView.addEventListener(this.cid,"focus",this.onFocus,this,this.inputSelector),this.inputView.addEventListener(this.cid,"blur",this.onBlur,this,this.inputSelector),this.inputView.addEventListener(this.cid,"keydown",this.onKeyDown,this,this.inputSelector))},undelegateInputEvents:function(){this.inputView&&this.inputView.removeEventListeners(this.cid)},delegateEvents:function(){r.view.View.prototype.delegateEvents.apply(this,arguments),this.delegateInputEvents()},undelegateEvents:function(){this.undelegateInputEvents(),r.view.View.prototype.undelegateEvents.apply(this,arguments)},getThrottle:function(){return this.throttle},setThrottle:function(e){this.throttle=e},getPreventDefaultOnEnter:function(){return this.preventDefaultOnEnter},setPreventDefaultOnEnter:function(e){return this.preventDefaultOnEnter=e,this},getBlurOnEnter:function(){return this.blurOnEnter},setBlurOnEnter:function(e){return this.blurOnEnter=e,this},getModel:function(){return this.model},setModel:function(e,t){e||(e=new n.Model({value:""}),t="value"),this.model&&this.stopListening(this.model),this.model=e,this.modelAttribute=t,this.listenTo(this.model,"change:"+t,this.onModelChange)},getInput:function(){var e;return this.inputView&&(e=this.inputView.$(this.inputSelector)),e},setInput:function(e,t){this.inputView&&this.undelegateInputEvents(),e&&(this.inputView=e,this.inputSelector=t,this.delegateInputEvents())},getInputValue:function(){return this.model.get(this.modelAttribute)},setInputValue:function(e,t){this.trim&&(e=r.string.trim(e)),this._lastInputValue=e,this.model.set(this.modelAttribute,e),t&&this.triggerEvent(i.CHANGE,{value:e})},classes:function(){return["input-handler"]},render:function(){var e=this.getInputValue();return this.$el.html(),this.$el.attr("class",this.classes().join(" ")),this.getInput().val(e),this},onModelChange:function(){var e=this.getInputValue(),t=this.getInput().val();(!this.trim||!t||e!==r.string.trim(t))&&this.getInput().val(e)},onFocus:function(e){this._startTimer()},onBlur:function(e){this._stopTimer(),this._update()},onKeyDown:function(e){switch(e.keyCode){case s.ENTER:this._update(),this.preventDefaultOnEnter&&(e.preventDefault(),e.stopPropagation(),this.blurOnEnter&&this.getInput().blur(),this.triggerEvent(o.ENTER_KEY,{value:this.getInputValue()}));break;default:this.updateDuringType||this._restartTimer()}},onTimer:function(){this._update()},_update:function(){var e=this.getInput().val();this.trim&&(e=r.string.trim(e)),e!==this._lastInputValue&&this.setInputValue(e,!0)},_startTimer:function(){this._timer||(this._timer=setInterval(t.bind(this.onTimer,this),this.throttle))},_stopTimer:function(){this._timer&&(clearInterval(this._timer),this._timer=null)},_restartTimer:function(){this._stopTimer(),this._startTimer()}});return{EventType:o,InputHandlerView:u}}),define("ui/ac/inputhandler",["jquery","underscore","../events/type","../events/keycodes","../input/views"],function(e,t,n,r,i){var s={CHANGE:n.CHANGE,ENTER_KEY:"enterkey"},o=i.InputHandlerView.extend({initialize:function(e){this.autocomplete=e.autocomplete,i.InputHandlerView.prototype.initialize.call(this,e)},getAutoComplete:function(){return this.autocomplete},setAutoComplete:function(e){return this.autocomplete=e,this},onBlur:function(e){i.InputHandlerView.prototype.onBlur.call(this,e),this.autocomplete.selectInput()},onKeyDown:function(e){switch(e.keyCode){case r.ESC:this.autocomplete.isOpen()&&(e.preventDefault(),e.stopPropagation(),this.autocomplete.close());break;case r.TAB:this._update(),this.autocomplete.isOpen()&&this.autocomplete.selectHighlighted()&&(e.preventDefault(),e.stopPropagation());break;case r.ENTER:this._update();if(this.autocomplete.isOpen()&&this.autocomplete.selectHighlighted())return e.preventDefault(),e.stopPropagation(),!0;this.autocomplete.selectInput(),this.preventDefaultOnEnter&&(e.preventDefault(),e.stopPropagation(),this.blurOnEnter&&this.getInput().blur(),this.triggerEvent(s.ENTER_KEY,{value:this.getInputValue()}));break;case r.UP:this.autocomplete.isOpen()&&(e.preventDefault(),e.stopPropagation(),this.autocomplete.highlightPrevious());break;case r.DOWN:this.autocomplete.isOpen()&&(e.preventDefault(),e.stopPropagation(),this.autocomplete.highlightNext());break;default:this.updateDuringType||this._restartTimer()}}});return{EventType:s,ACInputHandlerView:o}}),define("ui/ac/matcher",["jquery","underscore","core"],function(e,t,n){var r=n.base.Base.extend({initialize:function(e){e=t.extend({stringify:n.string.stringify},e),this.setStringify(e.stringify)},getStringify:function(){return this.stringify},setStringify:function(e){this.stringify=e},match:function(e,t,n){},_getPrefixMatches:function(e,r,i){var s=[],o=n.string.regExpEscape(r),u=new RegExp("(^|\\W+)"+o,"i");return t.each(e,function(e){if(s.length<i){var t=this.stringify(e);t.match(u)&&s.push(e)}},this),s=t.sortBy(s,function(e){return this.stringify(e)},this),s}}),i=r.extend({initialize:function(e){r.prototype.initialize.call(this,e),this.setData(e.data)},getData:function(){return this.data},setData:function(e){return this.data=e,this},match:function(e,t,n){var r=this._getPrefixMatches(this.data,e,t);n(e,r)}}),s=r.extend({initialize:function(e){r.prototype.initialize.call(this,e),this.setCollection(e.collection)},getCollection:function(){return this.collection},setCollection:function(e){return this.collection=e,this},match:function(e,t,n){var r=this._getPrefixMatches(this.collection.models,e,t);n(e,r)}}),o=r.extend({initialize:function(e){r.prototype.initialize.call(this,e),this.setQueryFactory(e.queryFactory),this.setMap(e.map)},getQueryFactory:function(){return this.query},setQueryFactory:function(e){this.queryFactory=e},getMap:function(){return this.map},setMap:function(e){return this.map=e,this},match:function(e,t,n){var r=this,i=this.queryFactory.create({search:e,maxResults:t});i.fetch({success:function(){r.onQuerySuccess(e,t,n,i)}})},onQuerySuccess:function(e,n,r,i){var s=i.instance,o=this._getPrefixMatches(s.models,e,s.length);this.map&&(o=t.map(o,this.map),o=t.filter(o,function(e){return!t.isNull(e)&&!t.isUndefined(e)}),o=t.first(o,n)),r(e,o)}});return{MatcherBase:r,ArrayMatcher:i,CollectionMatcher:s,QueryMatcher:o}}),define("ui/collection/views",["jquery","underscore","core"],function(e,t,n){var r={},i=n.view.View.extend({defaultTemplate:"",events:{},initialize:function(e){e=t.extend({template:this.defaultTemplate},e),this.template=t.template(e.template),this.context=e.context,this.collection=e.collection,this.viewFactory=e.viewFactory,this.selector=e.selector,this.sort=e.sort,this.modelViewMap={},this.listenTo(this.collection,"reset",this.onReset),this.listenTo(this.collection,"add",this.onAdd),this.listenTo(this.collection,"remove",this.onRemove),this.childViews=[],this.initChildViews()},initChildViews:function(){this.destroyChildViews(),this.childViews=[],this.modelViewMap={},this.collection.each(this.createChildView,this)},createChildView:function(e){var t=this.viewFactory.create({model:e});if(t){t.$el.addClass(this.childClasses().join(" ")),t.$el.data("id",e.id||e.cid);if(this.sort){var r=this.sort;n.array.binaryInsert(this.childViews,t,function(e,t){return n.array.defaultCompare(r(e),r(t))})}else this.childViews.push(t);this.modelViewMap[e.cid]=t}return t},appendChildView:function(e){this.append(e,this.selector)},removeChildView:function(e){this.childViews=t.without(e),e.destroy()},classes:function(){return["collection"]},childClasses:function(){return["item"]},eventToId:function(t){var n=this.$(t.currentTarget),r=n.parents().filter(function(){return e.hasData(this)&&e(this).data("id")}).first().data("id");return r},render:function(){var e=t.extend({collection:this.collection.toJSON()},n.base.getValue(this,"context",this));return this.$el.html(this.template(e)),this.$el.attr("class",this.classes().join(" ")),t.each(this.childViews,this.appendChildView,this),this},onReset:function(){this.initChildViews(),this.render()},onAdd:function(e){var t=this.createChildView(e);this.sort?this.render():this.appendChildView(t)},onRemove:function(e){var t=this.modelViewMap[e.cid];t&&(this.removeChildView(t),delete this.modelViewMap[e.cid])}}),s=n.view.View.extend({initialize:function(e){this.childView=e.view},childViews:function(){return[this.childView]},render:function(){return this.html(this.childView),this}}),o=s.extend({tagName:"li"}),u=i.extend({tagName:"ul",initialize:function(e){e=t.extend({wrap:!0},e);if(e.wrap){var r=e.viewFactory;e.viewFactory=new n.factory.FunctionFactory(function(e){var t=null,n=r.create(e);return n&&(t=new o({view:n})),t});if(e.sort){var s=e.sort;e.sort=function(e){return s(e.childView)}}}i.prototype.initialize.call(this,e)},classes:function(){return["collection-list"]}});return{EVENTS:r,CollectionView:i,ListView:u}}),define("text!ui/drop/templates/drop.html",[],function(){return'<div class="drop-inner">\n    <div data-cid="<%= cid %>" class="drop-content"></div>\n</div>\n'}),define("text!ui/drop/templates/drop_menu.html",[],function(){return'<ul>\n    <% _.each(items, function(item) { %>\n    <% if(item.key === \'divider\') { %>\n    <div class="drop-menu-divider"</>\n    <% } else { %>\n    <li><a data-item="<%= item.key %>" class="drop-menu-item drop-menu-item-<%= item.key %>" href="javascript:void(0)"><%=item.label %></a></li>\n    <% }}); %>\n</ul>\n'}),define("ui/drop/views",["jquery","underscore","core","core/view","../events/type","text!./templates/drop.html","text!./templates/drop_menu.html"],function(e,t,n,r,i,s,o){var u={},a=n.view.View.extend({defaultTemplate:s,events:{},childViews:function(){return[this.childView]},initialize:function(e){e=t.extend({autoclose:!0,useTargetWidth:!1,template:this.defaultTemplate,context:{}},e),this.template=t.template(e.template),this.context=e.context,this.autoclose=e.autoclose,this.autocloseGroup=e.autocloseGroup||"default",this.useTargetWidth=e.useTargetWidth,this.view=e.view,this.targetView=e.targetView,this.targetSelector=e.targetSelector,this.childView=null,this.childView=this.createChildView(this.view)},delegateEventName:function(e){return e+".delegateGlobalEvents"+this.cid},undelegateGlobalEvents:function(){e("html").off(this.delegateEventName(""))},delegateEvents:function(){n.view.View.prototype.delegateEvents.apply(this,arguments),this.autoclose&&(e("html").on(this.delegateEventName("click"),t.bind(this.onClick,this)),e("html").on(this.delegateEventName(i.OPEN),t.bind(this.onDropOpened,this)))},undelegateEvents:function(){this.undelegateGlobalEvents(),n.view.View.prototype.undelegateEvents.apply(this,arguments)},classes:function(){var e=["drop"];return this.targetView&&e.push("drop-absolute"),e},target:function(){var e;return this.targetView&&(e=this.targetView.$(this.targetSelector)),e},render:function(){var e=t.extend({cid:this.cid},n.base.getValue(this,"context",this));return this.$el.html(this.template(e)),this.$el.attr("class",this.classes().join(" ")),this.append(this.childView,".drop-content"),this},createChildView:function(e){var t;return e instanceof n.factory.Factory?t=e.create():t=e,t},position:function(){var e,t,n=this.target();n&&(e=n.offset(),e.top+=n.outerHeight(),t=this.$el.offsetParent().offset(),t&&(e.top-=t.top,e.left-=t.left),this.$el.css(e))},setWidth:function(){if(!this.useTargetWidth)return;var e=this.$(".drop-content"),t=e.width(),n=e.outerWidth(),r=n-t,i=this.target().outerWidth(!1);e.width(i-r)},isOpen:function(){var e=this.$(".drop-inner:first");return e.hasClass("drop-open")},open:function(){var e=this.$(".drop-inner:first");this.isOpen()||(this.position(),this.setWidth(),e.addClass("drop-open"),this.triggerEvent(i.OPEN,{view:this}))},close:function(){var e=this.$(".drop-inner:first");this.isOpen()&&(e.removeClass("drop-open"),this.triggerEvent(i.CLOSE,{view:this}))},toggle:function(){this.isOpen()?this.close():this.open()},onClick:function(t){if(!this.isOpen()||!this.autoclose)return;var n=e(t.target),r=n.closest(document.documentElement).length?!0:!1,i=n.closest(".drop-button").length?!0:!1,s=!1,o=n.closest(".drop-content");o.length&&o.first().data("cid")===this.cid&&(s=!0),r&&!i&&!s&&this.close()},onDropOpened:function(e,t){var n=t?t.view:null;this.autoclose&&n&&n.cid!==this.cid&&n.autocloseGroup===this.autocloseGroup&&this.close()}});return{EVENTS:u,DropView:a}}),define("ui/select/models",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({defaults:{value:null,selected:!1,highlighted:!1},value:function(){return this.get("value")},selected:function(){return this.get("selected")},highlighted:function(){return this.get("highlighted")}}),i=n.Collection.extend({model:r});return{Selection:r,SelectionCollection:i}}),define("ui/template/views",["jquery","underscore","core","api"],function(e,t,n,r){var i=n.view.View.extend({initialize:function(e){e=t.extend({modelEvents:"change",collectionEvents:"reset add remove",load:!1,classes:[]},e),this.model=e.model,this.modelEvents=e.modelEvents,this.modelWithRelated=e.modelWithRelated,this.collection=e.collection,this.collectionEvents=e.collectionEvents,this.collectionWithRelated=e.collectionWithRelated,this.context=e.context,this.load=e.load,this._classes=e.classes,this.template=t.template(e.template);var n=[];this.model&&(this.listenTo(this.model,this.modelEvents,this.render),n.push({instance:this.model,withRelated:this.modelWithRealted})),this.collection&&(this.listenTo(this.collection,this.collectionEvents,this.render),n.push({instance:this.collection,withRelated:this.collectionWithRealted})),n.length&&(this.loader=new r.loader.ApiLoader(n),this.load&&this.loader.load())},classes:function(){return this._classes},render:function(){var e=this.model?this.model.toJSON(this.modelWithRelated):null,r=this.collection?this.collection.toJSON(this.collectionWithRelated):null,i=t.extend({model:e,collection:r},n.base.getValue(this,"context",this));return this.$el.html(this.template(i)),this.$el.attr("class",this.classes().join(" ")),this}});return{TemplateView:i}}),define("text!ui/select/templates/select.html",[],function(){return'<ul class="select-list">\n    <% _.each(collection, function(model) { %>\n    <li class="selection" data-id="<%= model.id %>">\n        <%= model.value %>\n    </li>\n    <% }); %>\n</ul>\n'}),define("text!ui/select/templates/multi_select.html",[],function(){return'<ul class="multi-select-list">\n    <% _.each(collection, function(model) { %>\n    <li class="selection" data-id="<%= model.id %>">\n        <label>\n            <input type="checkbox" <%= model.selected ? \'checked="checked"\' : \'\' %> >\n            <%= model.value %>\n        </label>\n    </li>\n    <% }); %>\n</ul>\n'}),define("text!ui/select/templates/auto_multi_select.html",[],function(){return'<form class="form-inline">\n    <input type="text" class="search search-query" placeholder="<%= inputPlaceholder %>">\n</form>\n'}),define("text!ui/select/templates/auto_multi_select_list.html",[],function(){return'<ul class="auto-multi-select-list">\n    <% _.each(collection, function(model) { %>\n    <% if(model.selected) { %>\n    <li class="selection" data-id="<%= model.id %>">\n        <label>\n            <input type="checkbox" checked="checked">\n            <%= model.value %>\n        </label>\n    </li>\n    <% } %>\n    <% }); %>\n\n    <li class="divider"></li>\n\n    <% _.each(collection, function(model) { %>\n    <% if(!model.selected) { %>\n    <li class="selection" data-id="<%= model.id %>">\n        <label>\n            <input type="checkbox">\n            <%= model.value %>\n        </label>\n    </li>\n    <% } %>\n    <% }); %>\n</ul>\n'}),define("ui/select/views",["jquery","underscore","core","../events/type","../input/views","../select/models","../template/views","text!./templates/select.html","text!./templates/multi_select.html","text!./templates/auto_multi_select.html","text!./templates/auto_multi_select_list.html"],function(e,t,n,r,i,s,o,u,a,f,l){var c={},h=n.view.View.extend({initialize:function(e){e=t.extend({multiSelect:!1,selectedClass:"selected",highlightedClass:"highlighted"},e),this.template=t.template(e.template),this.multiSelect=e.multiSelect,this.selectedClass=e.selectedClass,this.highlightedClass=e.highlightedClass,this.collection=e.collection,this.setCollection(this.collection)},context:function(){var e=this.collection.map(function(e){var t=e.toJSON();return t.id=e.cid,t},this);return{collection:e}},classes:function(){return["select"]},render:function(){var e=this.context();return this.$el.html(this.template(e)),this.$el.attr("class",this.classes().join(" ")),this},modelSelector:function(e){return".selection[data-id="+e.cid+"]"},getCollection:function(){return this.collection()},setCollection:function(e){this.collection&&this.stopListening(this.collection),e&&(this.collection=e,this.listenTo(this.collection,"reset add remove",this.render))},getSelected:function(){var e=this.collection.where({selected:!0}),t=e.length?e[0]:null;return t},select:function(e,n){if(!e)return;this.multiSelect||t.each(this.getSelected(),function(t){e.cid!==t.cid&&this.unselect(t,dispatchEvent)},this),e.set({selected:!0}),this.$(this.modelSelector(e)).addClass(this.selectedClass),n&&this.triggerEvent(r.SELECT,{model:e})},unselect:function(e,t){if(!e)return;e.set({selected:!1}),this.$(this.modelSelector(e)).removeClass(this.selectedClass),t&&this.triggerEvent(r.UNSELECT,{model:e})},getHighlighted:function(){var e=this.collection.where({highlighted:!0}),t=e.length?e[0]:null;return t},highlight:function(e,t){if(!e)return;this.unhighlight(t),e.set({highlighted:!0}),this.$(this.modelSelector(e)).addClass(this.highlightedClass),t&&this.triggerEvent(r.HIGHLIGHT,{model:e})},unhighlight:function(e){var t=this.getHighlighted();if(!t)return;t.set({highlighted:!1}),this.$(this.modelSelector(t)).removeClass(this.highlightedClass),e&&this.triggerEvent(r.UNHIGHLIGHT,{model:t})}}),p=h.extend({defaultTemplate:u,events:{"click .selection":"onClick","mouseenter .selection":"onEnter","mouseleave .selection":"onLeave"},initialize:function(e){e=t.extend({template:this.defaultTemplate,multiSelect:!1},e),h.prototype.initialize.call(this,e)},onClick:function(t){var n=e(t.currentTarget).data("id"),r=this.collection.get(n);this.select(r,!0)},onEnter:function(t){var n=e(t.currentTarget).data("id"),r=this.collection.get(n);this.highlight(r)},onLeave:function(t){var n=e(t.currentTarget).data("id"),r=this.collection.get(n);this.unhighlight(r)}}),d=h.extend({defaultTemplate:a,events:{"change .selection":"onChange","mouseenter .selection":"onEnter","mouseleave .selection":"onLeave"},initialize:function(e){e=t.extend({template:this.defaultTemplate,multiSelect:!0},e),h.prototype.initialize.call(this,e)},classes:function(){return["multi-select"]},onChange:function(t){var n=t.target.checked,r=e(t.currentTarget).data("id"),i=this.collection.get(r);n?this.select(i,!0):this.unselect(i,!0)},onEnter:function(t){var n=e(t.currentTarget).data("id"),r=this.collection.get(n);this.highlight(r)},onLeave:function(t){var n=e(t.currentTarget).data("id"),r=this.collection.get(n);this.unhighlight(r)}}),v=n.view.View.extend({defaultTemplate:f,events:{"change .selection":"onSelectionChange","change .input-handler":"onInputChange"},initialize:function(e){e=t.extend({template:this.defaultTemplate,maxResults:8,inputPlaceholder:"search",throttle:250,updateDuringTyping:!1},e),this.template=t.template(e.template),this.collection=e.collection,this.matcher=e.matcher,this.maxResults=e.maxResults,this.inputPlaceholder=e.inputPlaceholder,this.throttle=e.throttle,this.updateDuringTyping=e.updateDuringTyping,this.matchCollection=new this.collection.constructor,this.inputHandlerView=null,this.listView=null,this.initChildViews()},initChildViews:function(){var e=function(e){var t=e.collection.map(function(e){var t=e.toJSON();return t.id=e.cid,t},this);return{collection:t}};this.inputHandlerView=new i.InputHandlerView({inputView:this,inputSelector:".search",throttle:this.throttle,updateDuringTyping:this.updateDuringTyping}),this.listView=new o.TemplateView({collection:this.collection,template:l,context:e})},childViews:function(){return[this.inputHandlerView,this.listView]},classes:function(){return["auto-multi-select"]},render:function(){var e={inputPlaceholder:this.inputPlaceholder};return this.$el.html(this.template(e)),this.$el.attr("class",this.classes().join(" ")),this.append(this.inputHandlerView),this.append(this.listView),this},refresh:function(){var e=this,t=this.input().val();this.matcher.match(t,this.maxResults,function(t,n){e.matchCollection.reset(n),e.updateCollection()})},input:function(){return this.$(".search")},updateCollection:function(){var e=this.collection.where({selected:!0}),t=new this.collection.constructor(e);this.matchCollection.each(function(n){t.where({value:n.get("value")}).length||e.push(n)},this),this.collection.reset(e)},select:function(e,t){if(!e)return;e.set({selected:!0}),t&&this.triggerEvent(r.SELECT,{model:e})},unselect:function(e,t){if(!e)return;e.set({selected:!1}),t&&this.triggerEvent(r.UNSELECT,{model:e})},onInputChange:function(e){this.refresh()},onSelectionChange:function(t){var n=t.target.checked,r=e(t.currentTarget).data("id"),i=this.collection.get(r);n?this.select(i,!0):this.unselect(i,!0)}});return{EVENTS:c,SelectView:p,MultiSelectView:d,AutoMultiSelectView:v}}),define("text!ui/ac/templates/multi_autocomplete.html",[],function(){return'<div class="outer-container">\n    <div class="list-container"></div>\n    <div class="input-container">\n        <input type="text" autocomplete="off">\n    </div>\n</div>\n'}),define("text!ui/ac/templates/multi_autocomplete_item.html",[],function(){return'<%= value %>\n<span class="close">x</span>\n'}),define("ui/ac/views",["jquery","underscore","backbone","core","../events/type","../events/keycodes","./inputhandler","../collection/views","../drop/views","../select/models","../select/views","../template/views","text!./templates/multi_autocomplete.html","text!./templates/multi_autocomplete_item.html"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d={SELECT:i.SELECT,ENTER_KEY:"enterkey"},v=new r.factory.Factory(o.ACInputHandlerView,{}),m=new r.factory.Factory(l.SelectView,{}),g=r.view.View.extend({events:{"select .drop":"onDropSelect","change .input-handler":"onInputChange","enterkey .input-handler":"onInputEnterKey"},initialize:function(e){e=t.extend({forceSelection:!0,maxResults:8,dropTargetView:e.inputView,dropTargetSelector:e.inputSelector,selectView:m,inputHandlerView:v,stringify:e.matcher.stringify,throttle:250,preventDefaultOnEnter:!0},e),this.forceSelection=e.forceSelection,this.maxResults=e.maxResults,this.inputView=e.inputView,this.inputSelector=e.inputSelector,this.dropTargetView=e.dropTargetView,this.dropTargetSelector=e.dropTargetSelector,this.stringify=e.stringify,this.throttle=e.throttle,this.preventDefaultOnEnter=e.preventDefaultOnEnter,this.matcher=e.matcher,this.selectionCollection=new f.SelectionCollection,this.lastMatches=null,this.lastSelectedMatch=null,this.dropView=null,this.inputHandlerView=e.inputHandlerView,this.selectView=e.selectView,this.initChildViews(),this.listenTo(this.selectionCollection,"change:selected",this.onSelectedChange),this.listenTo(this.selectionCollection,"change:highlighted",this.onHighlightedChange)},initChildViews:function(){this.inputHandlerView instanceof r.factory.Factory&&(this.inputHandlerView=this.inputHandlerView.create()),this.inputHandlerView.setAutoComplete(this),this.inputHandlerView.setInput(this.inputView,this.inputSelector),this.inputHandlerView.setThrottle(this.throttle),this.inputHandlerView.setPreventDefaultOnEnter(this.preventDefaultOnEnter),this.selectView instanceof r.factory.Factory&&(this.selectView=this.selectView.create()),this.selectView.setCollection(this.selectionCollection),this.dropView=new a.DropView({view:this.selectView,targetView:this.dropTargetView,targetSelector:this.dropTargetSelector,useTargetWidth:!0})},childViews:function(){return[this.inputHandlerView,this.dropView]},classes:function(){return["autocomplete"]},render:function(){return this.$el.html(),this.$el.attr("class",this.classes().join(" ")),this.append(this.inputHandlerView),this.append(this.dropView),this},clear:function(){this.inputHandlerView.setInputValue("")},clearLastMatch:function(){this.lastSelectedMatch=null,this.lastMatches=null,this.selectionCollection.reset()},focus:function(){this.inputHandlerView.getInput().focus()},blur:function(){this.inputHandlerView.getInput().blur()},highlightNext:function(){var e,t,n=this.selectView.getHighlighted();n?(t=this.selectionCollection.indexOf(n)+1,t<this.selectionCollection.length&&(e=this.selectionCollection.at(t))):this.selectionCollection.length&&(e=this.selectionCollection.at(0)),e?this.selectView.highlight(e):this.selectView.unhighlight()},highlightPrevious:function(){var e,t,n=this.selectionCollection.length,r=this.selectView.getHighlighted();r?(t=this.selectionCollection.indexOf(r)-1,t>=0&&(e=this.selectionCollection.at(t))):this.selectionCollection.length&&(e=this.selectionCollection.at(n-1)),e?this.selectView.highlight(e):this.selectView.unhighlight()},selectInput:function(){var e=this.inputHandlerView.getInputValue(),t=this._valueToMatch(e);t?this.setLastSelectedMatch(t,!0):this.forceSelection&&this.clear(),this.closeOnDelay()},selectHighlighted:function(){var e,t=this.selectView.getHighlighted();return t?(e=t.get("value"),this.inputHandlerView.setInputValue(e),this.close(),this.setLastSelectedMatch(this._valueToMatch(e),!0),!0):(this.close(),!1)},open:function(){this.dropView.open()},close:function(){this.dropView.close()},closeOnDelay:function(){setTimeout(t.bind(this.close,this),250)},isOpen:function(){return this.dropView.isOpen()},getLastSelectedMatch:function(){return this.lastSelectedMatch},setLastSelectedMatch:function(e,t){var n=this._matchToValue(e);if(this._equalsLastValue(n))return;this.lastSelectedMatch=e,t&&this.triggerEvent(i.SELECT,{match:e,value:this._matchToValue(e)})},onMatches:function(e,n){this.lastMatches=n;var r=this.inputHandlerView.getInputValue(),i=t.map(n,function(e){return{value:this.stringify(e)}},this);i.length?(this.open(),this.selectionCollection.reset(i)):this.close()},onSelectedChange:function(e){if(e.get("selected")){var t=e.get("value");this.inputHandlerView.setInputValue(t),this.close(),this.setLastSelectedMatch(this._valueToMatch(t),!0)}},onHighlightedChange:function(e){},onInputChange:function(e,n){var r=this.inputHandlerView.getInputValue();r?this.matcher.match(r,this.maxResults,t.bind(this.onMatches,this)):r||this.closeOnDelay()},onInputEnterKey:function(e,t){e.stopPropagation();var n=t.value;this._equalsLastValue(n)?this.triggerEvent(d.ENTER_KEY,{value:n,match:this.lastSelectedMatch}):this.forceSelection?this.focus():this.triggerEvent(d.ENTER_KEY,{value:n,match:null})},onDropSelect:function(e){e.stopPropagation()},_matchToValue:function(e){var t;return e&&(t=this.stringify(e)),t},_valueToMatch:function(e){var n=t.find(this.lastMatches,function(t){return this.stringify(t).toLowerCase()===e.toLowerCase()},this);return n},_equalsLastValue:function(e){var t=!1,n=this._matchToValue(this.lastSelectedMatch)||"";return e&&n&&(t=e.toLowerCase()===n.toLowerCase()),t}}),y=c.TemplateView.extend({initialize:function(e){this.stringify=e.stringify,e.template=p,e.classes=["multi-autocomplete-item"],e.context=function(e){return{value:this.stringify(e.model)}},c.TemplateView.prototype.initialize.call(this,e)}});y.Factory=r.factory.buildFactory(y);var b=r.view.View.extend({defaultTemplate:h,inputSelector:".input-container input",events:{"click .outer-container":"onOuterClick","select .autocomplete":"onSelect","click .close":"onClose","keypress .input-container input":"onInputKeypress","focus .input-container input":"onInputFocus","blur .input-container input":"onInputBlur"},initialize:function(e){e=t.extend({template:this.defaultTemplate,stringify:e.matcher.stringify},e),this.template=t.template(e.template),this.collection=e.collection,this.matcher=e.matcher,this.stringify=e.stringify,this.placeholder=e.placeholder,this.viewFactory=e.viewFactory||new y.Factory({stringify:e.stringify}),this.listenTo(this.collection,"reset add remove",this.onCollectionChange),this.autocompleteView=null,this.listView=null,this.initChildViews()},initChildViews:function(){this.autocompleteView=new g({inputView:this,inputSelector:this.inputSelector,dropTargetView:this,dropTargetSelector:".outer-container",matcher:this.matcher,stringify:this.stringify,forceSelection:!0}),this.listView=new u.ListView({collection:this.collection,viewFactory:this.viewFactory})},childViews:function(){return[this.listView,this.autocompleteView]},classes:function(){return["multi-autocomplete"]},render:function(){return this.$el.html(this.template()),this.$el.attr("class",this.classes().join(" ")),this.append(this.autocompleteView),this.append(this.listView,".list-container"),this.applyPlaceholder(),this},applyPlaceholder:function(){this.placeholder&&(this.collection.length===0?this.$(this.inputSelector).attr("placeholder",this.placeholder):this.collection.length===1&&this.$(this.inputSelector).attr("placeholder",null))},onCollectionChange:function(){this.applyPlaceholder()},onOuterClick:function(e){this.autocompleteView.focus()},onSelect:function(e,t){var n=t.match;this.collection.add(n),this.autocompleteView.clear(),this.autocompleteView.clearLastMatch(),this.autocompleteView.focus()},onInputKeypress:function(e){switch(e.keyCode){case s.BACKSPACE:!this.$(this.inputSelector).val()&&this.collection.length&&this.collection.pop()}},onClose:function(e){var t=this.listView.eventToId(e),n=this.collection.get(t);n&&this.collection.remove(n),this.autocompleteView.focus()},onInputFocus:function(e){this.$el.addClass("focus")},onInputBlur:function(e){this.$el.removeClass("focus")}});return{EventType:d,AutoCompleteView:g,MultiAutoCompleteView:b}}),define("text!ui/date/templates/date_month.html",[],function(){return'<table>\n    <thead>\n        <tr>\n            <th class="prev">‹</th>\n            <th colspan="5" class="month"><%= month %> <%= year %></th>\n            <th class="next">›</th>\n        </tr>\n        <tr>\n        <% _.each(daysOfWeek, function(dayOfWeek) { %>\n            <th class="day-of-week"> <%= dayOfWeek %></th>\n        <% }); %>\n        </tr>\n    </thead>\n    <tbody>\n    <% _.each(weeks, function(week) { %>\n        <tr class="week">\n            <% _.each(week, function(day) { %>\n            <td data-timestamp="<%= day.timestamp %>" class="day<%= day.selected ? \' selected\' : \'\' %><%= day.leftover ? \' leftover\' : \'\' %>">\n                <%= day.date %>\n            </td>\n            <% }); %>\n        </tr>\n    <% }); %>\n    </tbody>\n</table>\n'}),define("text!ui/date/templates/date_picker.html",[],function(){return""}),define("text!ui/date/templates/date_range.html",[],function(){return'<div class="span5">\n    <form class="form-inline">\n        <div class="all">\n            <label class="radio">All\n                <input type="radio" value="all" name="dateRangeRadios"<%= mode === \'all\' ? \' checked="checked"\': \'\'%>>\n            </label>\n        </div>\n        <div class="today">\n            <label class="radio">Today\n                <input type="radio" value="today" name="dateRangeRadios"<%= mode === \'today\' ? \' checked="checked"\': \'\'%>>\n            </label>\n        </div>\n        <div class="week">\n            <label class="radio">This week\n                <input type="radio" value="week" name="dateRangeRadios"<%= mode === \'week\' ? \' checked="checked"\': \'\'%>>\n            </label>\n        </div>\n        <div class="month">\n            <label class="radio">This month\n                <input type="radio" value="month" name="dateRangeRadios"<%= mode === \'month\' ? \' checked="checked"\': \'\'%>>\n            </label>\n        </div>\n        <div class="between">\n            <label class="radio">Date between\n                <input type="radio" value="between" name="dateRangeRadios"<%= mode === \'between\' ? \' checked="checked"\': \'\'%>>\n            </label>\n            <input type="text" class="between-start input-small" placeholder="mm/dd/yyyy">\n            <label>and</label>\n            <input type="text" class="between-end input-small" placeholder="mm/dd/yyyy">\n        </div>\n    </form>\n\n</div>\n'}),define("ui/date/views",["jquery","underscore","globalize","core","../drop/views","text!./templates/date_month.html","text!./templates/date_picker.html","text!./templates/date_range.html"],function(e,t,n,r,i,s,o,u){var a={DATE_CHANGED:"DATE_CHANGED_EVENT",DATE_RANGE_CHANGED:"DATE_RANGE_CHANGED_EVENT"},f=r.view.View.extend({defaultTemplate:s,events:{"click .day":"onClickDay","click .next":"onClickNext","click .prev":"onClickPrev"},initialize:function(e){e=e||{},this.template=t.template(this.defaultTemplate),this.model=e.model,this.attribute=e.attribute,this.daysOfWeek=["Su","Mo","Tu","We","Tu","Fr","Sa"],this.months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.model||(this.model=new Backbone.Model({date:null}),this.attribute="date"),this.today=this.getDate()||new r.date.Date,this.listenTo(this.model,"change:"+this.attribute,this.onChange)},classes:function(){return["date-month"]},getDate:function(){return this.model.get(this.attribute)},setDate:function(e){return this.model.set(this.attribute,e),this},getToday:function(){return this.today},setToday:function(e){return this.today=e||this.getDate()||new r.date.Date,this},render:function(){var e=this.context();return this.$el.html(this.template(e)),this.$el.attr("class",this.classes().join(" ")),this},context:function(){var e,t=[],n=this.getDate(),i=r.date.DateRange.calendarMonth(this.today).iterator(),s=this.today.getMonth(),o=this.today.getFullYear(),u=function(t){e.push({timestamp:t.getTime(),month:t.getMonth()+1,date:t.getDate(),year:t.getFullYear(),leftover:t.getMonth()!==s,selected:t.equals(n)})};for(;;){e=[],r.iter.forEach(r.iter.slice(i,0,7),u);if(!e.length)break;t.push(e)}return{daysOfWeek:this.daysOfWeek,month:this.months[s],year:o,weeks:t}},onChange:function(){var e=this.getDate();e?this.today=e.clone():this.today=new r.date.Date,this.render()},onClickDay:function(t){var n=e(t.currentTarget),i=n.data("timestamp"),s=new r.date.Date(new Date(i));s.equals(this.getDate())||(this.setDate(s.clone()),this.triggerEvent(a.DATE_CHANGED,{date:s}))},onClickNext:function(e){this.today.add(new r.date.Interval(0,1)),this.render()},onClickPrev:function(e){this.today.add(new r.date.Interval(0,-1)),this.render()}}),l=r.view.View.extend({defaultTemplate:o,events:{},initialize:function(e){e=e||{},this.template=t.template(this.defaultTemplate),this.model=e.model,this.attribute=e.attribute,this.model||(this.model=new Backbone.Model({date:null}),this.attribute="date"),this.monthView=null,this.initChildViews()},initChildViews:function(){this.monthView=new f({model:this.model,attribute:this.attribute})},childViews:function(){return[this.monthView]},classes:function(){return["date-picker"]},render:function(){return this.$el.html(this.template()),this.$el.attr("class",this.classes().join(" ")),this.append(this.monthView),this},getDate:function(){return this.model.get(this.attribute)},setDate:function(e){return this.model.set(this.attribute,e),this},getToday:function(){return this.monthView.getToday()},setToday:function(e){return this.monthView.setToday(e),this}}),c=r.view.View.extend({events:{},initialize:function(e){e=t.extend({autoclose:!0},e),this.model=e.model,this.attribute=e.attribute,this.inputView=e.inputView,this.inputSelector=e.inputSelector,this.autoclose=e.autoclose,this.autocloseGroup=e.autocloseGroup,this.formats=["MM/dd/yyyy"],this.model||(this.model=new Backbone.Model({date:null}),this.attribute="date"),this.listenTo(this.model,"change:"+this.attribute,this.onDateChanged),this.dropView=null,this.initChildViews()},initChildViews:function(){var e=new r.factory.Factory(l,{model:this.model,attribute:this.attribute});this.dropView=new i.DropView({autoclose:this.autoclose,autocloseGroup:this.autocloseGroup,targetView:this.inputView,targetSelector:this.inputSelector,view:e})},childViews:function(){return[this.dropView]},input:function(){return this.inputView.$(this.inputSelector)},updateInput:function(){var e,t=this.getDate();t&&(e=n.format(t.date,this.formats[0]),this.input().val(e))},delegateEvents:function(){r.view.View.prototype.delegateEvents.apply(this,arguments),this.inputView.addEventListener(this.cid,"focus",this.onFocus,this,this.inputSelector),this.inputView.addEventListener(this.cid,"blur",this.onBlur,this,this.inputSelector),this.inputView.addEventListener(this.cid,"keyup",this.onKeyUp,this,this.inputSelector)},undelegateEvents:function(){this.inputView.removeEventListeners(this.cid),r.view.View.prototype.undelegateEvents.apply(this,arguments)},classes:function(){return["date-picker-drop"]},render:function(){return this.$el.html(),this.$el.attr("class",this.classes().join(" ")),this.append(this.dropView),this.updateInput(),this},getDate:function(){return this.model.get(this.attribute)},setDate:function(e){return this.model.set(this.attribute,e),this},onDateChanged:function(e){this.updateInput()},onFocus:function(e){this.dropView.autoclose=!1,this.dropView.open()},onBlur:function(e){this.dropView.autoclose=!0},onKeyUp:function(e){var t,i=this.getDate(),s=this.input().val();s?(t=n.parseDate(s,this.formats),t&&(t=new r.date.Date(t))):(t=null,update=!0);if(t&&i&&!i.equals(t)||t!==i)this.setDate(t),this.triggerEvent(a.DATE_CHANGED,{date:t})}}),h=r.view.View.extend({defaultTemplate:u,events:{"change input:radio":"onRadioChanged","focus .between-start":"onBetweenFocused","focus .between-end":"onBetweenFocused",DATE_CHANGED_EVENT:"onDateChanged"},initialize:function(e){e=t.extend({template:this.defaultTemplate,range:r.date.DateRange.allTime()},e),this.template=t.template(e.template),this.mode=e.mode,this.startModel=e.startModel,this.startAttribute=e.startAttribute,this.endModel=e.endModel,this.endAttribute=e.endAttribute,this.startModel||(this.startModel=new Backbone.Model({date:null}),this.startAttribute="date"),this.endModel||(this.endModel=new Backbone.Model({date:null}),this.endAttribute="date"),this.listenTo(this.startModel,"change:"+this.startAttribute,this.onModelChanged),this.listenTo(this.endModel,"change:"+this.endAttribute,this.onModelChanged),this.startDateView=null,this.endDateView=null,this.initChildViews(),this.setDateRange(e.range)},childViews:function(){return[this.startDateView,this.endDateView]},initChildViews:function(){this.startDateView=new c({autocloseGroup:this.cid,inputView:this,inputSelector:".between-start"}),this.endDateView=new c({inputView:this,inputSelector:".between-end"})},classes:function(){return["date-range"]},context:function(){return{mode:this.mode}},render:function(){return this.$el.html(this.template(this.context())),this.$el.attr("class",this.classes().join(" ")),this.append(this.startDateView),this.append(this.endDateView),this},getStartDate:function(){return this.startModel.get(this.startAttribute)},setStartDate:function(e,t){return this.startModel.set(this.startAttribute,e,t),this},getEndDate:function(){return this.endModel.get(this.endAttribute)},setEndDate:function(e,t){return this.endModel.set(this.endAttribute,e,t),this},getDateRange:function(){return new r.date.DateRange(this.getStartDate(),this.getEndDate())},setDateRange:function(e){return this.setStartDate(e.start,{silent:!0}),this.setEndDate(e.end),this},onModelChanged:function(e){var t,n,i=this.getDateRange();r.date.DateRange.allTime().equals(i)?t="all":r.date.DateRange.today().equals(i)?t="today":r.date.DateRange.thisWeek().equals(i)?t="week":r.date.DateRange.thisMonth().equals(i)?t="month":t="between",t!==this.mode&&(this.mode=t,n="input:radio[value="+t+"]",this.$(n).attr("checked","checked")),this.mode==="between"&&(this.startDateView.setDate(i.start?i.start.clone():null),this.endDateView.setDate(i.end?i.end.clone():null))},onRadioChanged:function(t){var n,i=e(t.currentTarget),s=i.val();switch(s){case"all":n=r.date.DateRange.allTime();break;case"today":n=r.date.DateRange.today();break;case"week":n=r.date.DateRange.thisWeek();break;case"month":n=r.date.DateRange.thisMonth();break;case"between":n=new r.date.DateRange(this.startDateView.getDate(),this.endDateView.getDate())}this.setDateRange(n),this.triggerEvent(a.DATE_RANGE_CHANGED,{dateRange:this.getDateRange()})},onDateChanged:function(e){this.setDateRange(new r.date.DateRange(this.startDateView.getDate(),this.endDateView.getDate())),this.triggerEvent(a.DATE_RANGE_CHANGED,{dateRange:this.getDateRange()})},onBetweenFocused:function(e){if(this.mode!=="between"){var t=new r.date.DateRange(this.startDateView.getDate(),this.endDateView.getDate());this.setDateRange(t)}}});return{EVENTS:a,DatePickerView:l,DatePickerDropView:c,DateRangeView:h}}),define("text!ui/facet/templates/facets.html",[],function(){return""}),define("text!ui/facet/templates/facet.html",[],function(){return'<div class="header">\n    <span class="title"><%= title %></span>\n    <span class="arrow"></span>\n</div>\n<div class="facet-items"></div>\n\n'}),define("text!ui/facet/templates/auto_facet.html",[],function(){return'<div class="header">\n    <span class="title"><%= title %></span>\n    <span class="arrow"></span>\n</div>\n<div class="facet-items"></div>\n<div class="auto-controls">\n    <a href="#" class="add">Add</a>\n    <input class="auto-facet-input" type="text" autocomplete="off" placeholder="<%= placeholder %>">\n</div>\n\n'}),define("text!ui/facet/templates/facet_item.html",[],function(){return'<label class="checkbox" title="<%= name %>">\n    <input type="checkbox"<%= enabled ? \' checked="checked"\' : \'\' %>>\n    <div class="name"><%= name %></div>\n    <% if(count !== null) { %>\n    <span class="count">(<%=count %>)</span>\n    <% } %>\n</label>\n'}),define("ui/facet/views",["jquery","underscore","core","api","../events/type","../ac/views","../collection/views","text!./templates/facets.html","text!./templates/facet.html","text!./templates/auto_facet.html","text!./templates/facet_item.html"],function(e,t,n,r,i,s,o,u,a,f,l){var c={OPEN:i.OPEN,CLOSE:i.CLOSE,FILTER:"FILTER_EVENT"},h=n.view.View.extend({defaultTemplate:a,events:{"click .header":"onClick"},initialize:function(e){e=t.extend({template:this.defaultTemplate,sortOrder:1e3,open:!0},e),this.template=t.template(e.template),this.name=e.name,this.title=e.title,this.model=e.model,this.query=e.query,this.viewFactory=e.viewFactory,this.sortOrder=e.sortOrder,this.facetItemsView=null,this.initChildViews(),e.open&&this.open()},childViews:function(){return[this.facetItemsView]},initChildViews:function(){this.facetItemsView=new o.ListView({viewFactory:this.viewFactory,collection:this.model.items()})},render:function(){var e=this.context();return this.$el.html(this.template(e)),this.$el.attr("class",this.classes().join(" ")),this.append(this.facetItemsView,".facet-items"),this},context:function(){return{name:this.name,title:this.title}},classes:function(){var e=["facet","facet-"+this.name.toLowerCase().replace(" ","-")];return this.isOpen()&&e.push("facet-open"),e},isOpen:function(){return this.$el.hasClass("facet-open")},open:function(){this.isOpen()||(this.$el.addClass("facet-open"),this.triggerEvent(i.OPEN,{view:this}))},close:function(){this.isOpen()&&(this.$el.removeClass("facet-open"),this.triggerEvent(i.CLOSE,{view:this}))},toggle:function(){this.isOpen()?this.close():this.open()},onClick:function(e){this.toggle()}});h.Factory=n.factory.buildFactory(h);var p=h.extend({defaultTemplate:f,events:t.extend({"select .autocomplete":"onSelect","click .add":"onClickAdd"},h.prototype.events),initialize:function(e){this.matcher=e.matcher,this.placeholder=e.placeholder||"",this.acView=null,this._createFacetItems(),h.prototype.initialize.call(this,e)},childViews:function(){return result=h.prototype.childViews.call(this),result},initChildViews:function(){h.prototype.initChildViews.call(this),this.acView=new s.AutoCompleteView({inputView:this,inputSelector:".auto-facet-input",matcher:this.matcher})},render:function(){return h.prototype.render.call(this),this.append(this.acView),this},context:function(){var e=h.prototype.context.call(this);return e.placeholder=this.placeholder,e},classes:function(){var e=h.prototype.classes.call(this);return e.push("auto-facet"),e},onSelect:function(e,t){var n,i,s=t.value,o=r.query.ApiQueryFilter.parse(this.model.filter()),u=this.model.items().get(s);this.acView.clear(),this.acView.clearLastMatch();if(u&&u.enabled())return;o.value()?n=o.setValue(o.value()+","+s):n=o.setValue(s),this.triggerEvent(c.FILTER,{filter:o})},onClickAdd:function(e){e.preventDefault(),this.$el.addClass("show-auto"),this.$(".auto-facet-input").focus()},_createFacetItems:function(){var e=r.query.ApiQueryFilter.parse(this.model.filter()),n=e.value();if(!n)return;n=n.split(","),t.each(n,function(r){if(!this.model.items().get(r)){var i=e.clone().setValue(t.without(n,r).join(","));this.model.items().add({name:r,enabled:!0,disable_filter:i})}},this)}});p.Factory=n.factory.buildFactory(p);var d=n.view.View.extend({defaultTemplate:l,events:{"click input":"onClick"},initialize:function(e){this.template=t.template(this.defaultTemplate),this.model=e.model},classes:function(){return["facet-item"]},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this.$el.attr("class",this.classes().join(" ")),this},onClick:function(e){var t=this.$(e.currentTarget),n=t.prop("checked");n?this.triggerEvent(c.FILTER,{filter:this.model.enable_filter()}):this.triggerEvent(c.FILTER,{filter:this.model.disable_filter()})}});d.Factory=n.factory.buildFactory(d);var v=o.ListView.extend({defaultTemplate:u,events:{FILTER_EVENT:"onFilter"},initialize:function(e){e=t.extend({template:this.defaultTemplate,includeAll:!1,viewFactory:new n.factory.FunctionFactory(t.bind(this.createFacetView,this)),sort:function(e){return e.sortOrder}},e),this.config=e.config,this.query=e.query,this.includeAll=e.includeAll,this.facetConfigMap={},this.facetViewFactory=new h.Factory,this.facetItemViewFactory=new d.Factory;var r=1;t.each(this.config.facets,function(e){e.sortOrder=r++,this.facetConfigMap[e.name]=e},this),o.ListView.prototype.initialize.call(this,e)},classes:function(){return["facets"]},createFacetView:function(e){var t=null,n=this.facetConfigMap[e.model.name()];this.includeAll&&!n&&(n={});if(n){var r=n.title||e.model.title(),i=n.facetView||this.facetViewFactory,s=n.facetItemView||this.facetItemViewFactory,o=n.open===!1?!1:!0;t=i.create({name:e.model.name(),title:r,model:e.model,query:this.query,viewFactory:s,sortOrder:n.sortOrder||1e3,open:o})}return t},onReset:function(){var e={};t.each(this.childViews,function(t){var n=t.childView;e[n.model.name()]=n.isOpen()},this),this.initChildViews(),t.each(this.childViews,function(t){var n=t.childView,r=e[n.model.name()];r===!0?n.open():r===!1&&n.close()},this),this.render()},onFilter:function(e,t){this._applyFilter(t.filter)},_applyFilter:function(e){t.isString(e)&&(e=r.query.ApiQueryFilter.parse(e));var n=this.query.state.filters();n.remove(n.getFilters(e.name())),n.add(e);var i=20,s=this.query.state.slice();s&&(i=s.end()-s.start()),this.query.slice(0,i).fetch()}});return{EventType:c,FacetsView:v,FacetView:h,AutoFacetView:p}}),define("ui/filter/models",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({idAttribute:"field",defaults:{field:null,view:null},field:function(){return this.get("field")},view:function(){return this.get("view")}}),i=n.Collection.extend({model:r});return{FilterView:r,FilterViewCollection:i}}),define("text!ui/filter/templates/filters.html",[],function(){return""}),define("text!ui/filter/templates/filter.html",[],function(){return'<div class="btn-group">\n    <button class="btn drop-button">\n        <div class="filter-wrap">\n            <span class="filter-wrap-name"><%= name %>: </span>\n            <span class="filter-wrap-title"><%= title %></span>\n        </div>\n        <span class="caret"></span>\n    </button>\n    <button class="btn filter-close"><span class="close">x</span></button>\n</div>\n'}),define("text!ui/filter/templates/filter_factory.html",[],function(){return'<button class="btn drop-button">Filters <i class="icon-plus"></i></button>\n'}),define("text!ui/filter/templates/filter_factory_drop.html",[],function(){return'<ul>\n    <% _.each(filters, function(filter) { %>\n    <li>\n        <label>\n            <input data-name="<%= filter.name %>" type="checkbox">\n            <%= filter.name %>\n        </label>\n    </li>\n    <% }); %>\n</ul>\n'}),define("ui/filter/views",["jquery","underscore","core","api","../date/views","../drop/views","../filter/models","../select/models","../select/views","text!./templates/filters.html","text!./templates/filter.html","text!./templates/filter_factory.html","text!./templates/filter_factory_drop.html"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p={FILTER_VIEW_CREATE:"FILTER_VIEW_CREATE_EVENT",FILTER_VIEW_DESTROY:"FILTER_VIEW_DESTROY_EVENT",FILTER_APPLY:"FILTER_APPLY_EVENT"},d=n.view.View.extend({defaultTemplate:l,events:{"click .drop-button":"onToggle","click .filter-close":"onClose","open .drop":"_onDropOpened","close .drop":"_onDropClosed"},childViews:function(){return[this.dropView]},initialize:function(e){this.template=t.template(this.defaultTemplate),this.collection=e.collection,this.name=e.name,this.field=e.field,this.query=e.query,this.view=e.view,this.dropView=null,this.initChildViews()},initChildViews:function(){this.dropView=new s.DropView({autocloseGroup:"filter",view:this.view})},render:function(){var e={name:this.name,title:this.title()};return this.$el.html(this.template(e)),this.$el.attr("class",this.classes().join(" ")),this.append(this.dropView),this},classes:function(){return["filter","filter-"+this.name.toLowerCase().replace(" ","-")]},getSubview:function(){return this.dropView.childView},filters:function(e,t){var n,r=this.query.state.filters();return t?n=r.where({name:e,op:t}):n=r.where({name:e}),n},title:function(){},updateTitle:function(){this.$(".filter-wrap-title").text(this.title())},onFilterOpened:function(){},onFilterClosed:function(){},onToggle:function(e){this.dropView.toggle()},onClose:function(e){this.triggerEvent(p.FILTER_VIEW_DESTROY,{field:this.field})},_onDropOpened:function(e,t){t.view===this.dropView&&this.onFilterOpened()},_onDropClosed:function(e,t){t.view===this.dropView&&this.onFilterClosed()}}),v=d.extend({initialize:function(e){this.selections=e.selections,this.selectionCollection=new u.SelectionCollection,this.filterToSelection=e.filterToSelection||this.passThrough,this.selectionToFilter=e.selectionToFilter||this.passThrough;var n=new a.MultiSelectView({collection:this.selectionCollection});e=t.extend({view:n},e),d.prototype.initialize.call(this,e),this.selectionCollection.reset(this.filterToSelectionModels()),this.listenTo(this.selectionCollection,"change:selected",this.onSelected)},title:function(){var e="ALL";return filter=t.first(this.filters(this.field,"in")),filter&&(e=this.filterToSelection(filter.value())),e},passThrough:function(e){return e},filterToSelectionModels:function(){var e,n,r=[];return n=t.first(this.filters(this.field,"in")),n&&(r=t.map(n.value().split(","),this.filterToSelection)),this.selections?e=t.map(this.selections,function(e){return new u.Selection({value:e,selected:t.contains(r,e)})},this):e=t.map(r,function(e){return new u.Selection({value:e,selected:!0})}),e},selectionCollectionToFilter:function(){var e=null,n=this.selectionCollection.where({selected:!0}),i=t.map(n,function(e){return e.value()},this);return i.length&&(e=new r.query.ApiQueryFilter({name:this.field,value:t.map(i,this.selectionToFilter).join(","),op:"in"})),e},onSelected:function(e){this.query.state.filters().remove(this.filters(this.field,"in"));var t=this.query.state.filters(),n=this.selectionCollectionToFilter();t.remove(t.where({name:this.field})),n&&this.query.state.filters().add(n),this.updateTitle(),this.triggerEvent(p.FILTER_APPLY,{field:this.field})}});v.Factory=n.factory.buildFactory(v);var m=v.extend({initialize:function(e){this.selectionCollection=new u.SelectionCollection,this.filterToSelection=e.filterToSelection||this.passThrough,this.selectionToFilter=e.selectionToFilter||this.passThrough;var n=new a.AutoMultiSelectView({collection:this.selectionCollection,matcher:e.matcher,inputPlaceholder:e.inputPlaceholder||"search"});e=t.extend({view:n},e),d.prototype.initialize.call(this,e),this.selectionCollection.reset(this.filterToSelectionModels()),this.listenTo(this.selectionCollection,"change:selected",this.onSelected)},onFilterOpened:function(){this.dropView.childView.refresh(),this.dropView.childView.input().focus()}});m.Factory=n.factory.buildFactory(m);var g=d.extend({events:function(){var e=t.extend({},t.result(d.prototype,"events"));return e[i.EVENTS.DATE_RANGE_CHANGED]="onDateRangeChanged",e},initialize:function(e){e=t.extend({view:new i.DateRangeView},e),d.prototype.initialize.call(this,e);var n=this.filterToDateRange(this.getFilter());n&&this.getSubview().setDateRange(n)},title:function(){var e,t="ALL";return filter=this.getFilter(),filter&&(e=this.filterToDateRange(filter),n.date.DateRange.allTime().equals(e)?t="ALL":n.date.DateRange.today().equals(e)?t="Today":n.date.DateRange.thisWeek().equals(e)?t="This week":n.date.DateRange.thisMonth().equals(e)?t="This month":t=e.start.format("MM/dd/yy")+"-"+e.end.format("MM/dd/yy")),t},filterToDateRange:function(e){var t,r,i,s;return e&&(i=e.value().split(":"),t=n.date.Date.fromTimestamp(parseFloat(i[0])),r=n.date.Date.fromTimestamp(parseFloat(i[1])),s=new n.date.DateRange(t,r)),s},dateRangeToFilter:function(e){var t,i,s,o;return e&&e.start&&e.end&&(i=new n.date.DateTime(e.start.date),s=(new n.date.DateTime(e.end.date)).add(new n.date.Interval(0,0,0,23,59,59)),o=[i.getTimestamp(),s.getTimestamp()],t=new r.query.ApiQueryFilter({name:this.field,value:o.join(":"),op:"range"})),t},getFilter:function(){return t.first(this.filters(this.field,"range"))},setFilter:function(e){var t=this.query.state.filters();t.remove(t.where({name:this.field})),e&&this.query.state.filters().add(e),this.updateTitle()},onDateRangeChanged:function(e,t){var r=t.dateRange;n.date.DateRange.allTime().equals(r)?this.setFilter(null):r.start&&r.end&&this.setFilter(this.dateRangeToFilter(r)),this.triggerEvent(p.FILTER_APPLY,{field:this.field})}});g.Factory=n.factory.buildFactory(g);var y=n.view.View.extend({defaultTemplate:c,events:{"click .drop-button":"onToggle"},childViews:function(){return[this.dropView]},initialize:function(e){this.template=t.template(this.defaultTemplate),this.config=e.config,this.collection=e.collection,this.filterConfigMap={},this.selectionCollection=new u.SelectionCollection(this.configToSelectionModels()),t.each(this.config.filters,function(e){this.filterConfigMap[e.name]=e},this),this.listenTo(this.collection,"reset add remove",this.onFilterViewUpdate),this.listenTo(this.selectionCollection,"change:selected",this.onSelected),this.dropView=null,this.initChildViews()},initChildViews:function(){var e=new n.factory.Factory(a.MultiSelectView,{collection:this.selectionCollection});this.dropView=new s.DropView({autocloseGroup:"filter",view:e})},render:function(){return this.$el.html(this.template()),this.$el.attr("class",this.classes().join(" ")),this.append(this.dropView),this},classes:function(){return["filter-factory"]},configToSelectionModels:function(){var e=this.collection.pluck("field"),n=t.map(this.config.filters,function(n){return new u.Selection({value:n.name,selected:t.contains(e,n.field)})},this);return n},onFilterViewUpdate:function(e){this.selectionCollection.reset(this.configToSelectionModels())},onSelected:function(e){var t=this.filterConfigMap[e.value()];e.selected()?this.triggerEvent(p.FILTER_VIEW_CREATE,{field:t.field}):this.triggerEvent(p.FILTER_VIEW_DESTROY,{field:t.field})},onToggle:function(e){this.dropView.toggle()}}),b=n.view.View.extend({defaultTemplate:f,events:{FILTER_VIEW_CREATE_EVENT:"onFilterViewCreate",FILTER_VIEW_DESTROY_EVENT:"onFilterViewDestroy",FILTER_APPLY_EVENT:"onFilterApply"},childViews:function(){var e=[this.factoryView];return e=e.concat(this.filterViews.pluck("view")),e},initialize:function(e){e=t.extend({template:this.defaultTemplate,context:{}},e),this.template=t.template(e.template),this.context=e.context,this.config=e.config,this.collection=e.collection,this.query=e.query,this.horizontal=e.horizontal||!1,this.filterConfigMap={},t.each(this.config.filters,function(e){this.filterConfigMap[e.field]=e},this),this.filterViews=new o.FilterViewCollection,this.factoryView=null,this.initChildViews()},initChildViews:function(){this.createFilterViews(),this.factoryView=new y({config:this.config,collection:this.filterViews})},classes:function(){var e=["filters"];return this.horizontal&&e.push("horizontal"),e},render:function(){var e=n.base.getValue(this,"context",this);return this.$el.html(this.template(e)),this.$el.attr("class",this.classes().join(" ")),this.append(this.factoryView),t.each(this.filterViews.pluck("view"),function(e){this.append(e)},this),this},createFilterViews:function(){var e,n=t.uniq(this.query.state.filters().pluck("name"));return e=t.map(n,function(e){return this.createFilterView(e)},this),e},createFilterView:function(e){var t=this.filterConfigMap[e],n=t.filterView.create({name:t.name,field:t.field,collection:this.colleciton,query:this.query});return this.filterViews.add({field:e,view:n}),n},destroyFilterView:function(e){var t=this.filterViews.get(e),n=this.query.state.filters();t&&(t.view().destroy(),n.remove(n.where({name:e})),this.filterViews.remove(this.filterViews.where({field:e})),this.filter())},filter:function(){var e=20,t=this.query.state.slice();t&&(e=t.end()-t.start()),this.query.slice(0,e).fetch()},onFilterViewCreate:function(e,t){var n=this.createFilterView(t.field);this.append(n)},onFilterViewDestroy:function(e,t){this.destroyFilterView(t.field)},onFilterApply:function(e,t){this.filter()}});return{EVENTS:p,FiltersView:b,SelectFilterView:v,AutoSelectFilterView:m,DateRangeFilterView:g}}),define("ui/menu/models",["jquery","underscore","backbone"],function(e,t,n){var r=n.Model.extend({defaults:{key:null,label:null,enabled:!0,visible:!0,handler:null},key:function(){return this.get("key")},label:function(){return this.get("label")},enabled:function(){return this.get("enabled")},visible:function(){return this.get("visible")},handler:function(){return this.get("handler")}}),i=n.Collection.extend({model:r});return{MenuItem:r,MenuItemCollection:i}}),define("text!ui/menu/templates/menu.html",[],function(){return'<ul>\n    <% _.each(_.where(collection, {visible: true}), function(model) { %>\n    <% if(model.key === \'divider\') { %>\n    <div class="menu-divider"</>\n    <% } else { %>\n    <li class="menu-item menu-item-<%= model.key %>" data-key="<%= model.key %>"><a href="javascript:void(0)"><%=model.label %></a></li>\n    <% }}); %>\n</ul>\n'}),define("ui/menu/views",["jquery","underscore","core","../events/type","../drop/views","../template/views","text!./templates/menu.html"],function(e,t,n,r,i,s,o){var u={},a=s.TemplateView.extend({events:{"click .menu-item":"onItemClick"},initialize:function(e){e=t.extend({template:o},e),s.TemplateView.prototype.initialize.call(this,e)},classes:function(){return["menu"]},onItemClick:function(e){var t=this.$(e.currentTarget),n=this.collection.where({key:t.data("key")})[0],i=n.handler();i&&i.call(this,n),this.triggerEvent(r.SELECT,{model:n})}}),f=i.DropView.extend({events:{"select .drop-content":"onSelect"},initialize:function(e){var r=new n.factory.Factory(a,{collection:e.collection});delete e.collection,e=t.extend({view:r},e),i.DropView.prototype.initialize.call(this,e)},onSelect:function(e){this.close()}});return{EVENTS:u,MenuView:a,DropMenuView:f}}),define("text!ui/grid/templates/grid.html",[],function(){return'<table class="grid-table">\n<thead></thead>\n<tbody></tbody>\n</table>\n'}),define("text!ui/grid/templates/grid_header_cell.html",[],function(){return'<span><%= column %></span>\n<span class="grid-sort-arrow"></span>\n'}),define("text!ui/grid/templates/grid_cell.html",[],function(){return"<span><%= value %></span>\n"}),define("text!ui/grid/templates/grid_link_cell.html",[],function(){return"<a href='<%= href %>'><%= value %></a>\n"}),define("text!ui/grid/templates/grid_action_cell.html",[],function(){return'<div class="grid-action-cell-inner">\n    <button class="drop-button btn btn-mini">\n        <i class="icon-cog"></i>\n        <span class="caret"></span>\n    </button>\n</div>\n'}),define("ui/grid/views",["jquery","underscore","core","api","../drop/views","../menu/models","../menu/views","text!./templates/grid.html","text!./templates/grid_header_cell.html","text!./templates/grid_cell.html","text!./templates/grid_link_cell.html","text!./templates/grid_action_cell.html"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h={GRID_ACTION:"GRID_ACTION_EVENT",GRID_SORT:"GRID_SORT_EVENT"},p=n.view.View.extend({events:{},childViews:function(){return[this.childView]},initialize:function(e){e=t.extend({template:""},e),this.template=t.template(e.template),this.context=e.context,this.config=e.config,this.query=e.query,this.model=e.model,this.viewConfig=e.view,this.childView=this.createChildView(this.viewConfig)},classes:function(){var e=["grid-hover-cell","grid-hover-cell-"+this.config.key];return e},render:function(){var e=t.extend({},n.base.getValue(this,"context",this));return this.$el.html(this.template(e)),this.$el.attr("class",this.classes().join(" ")),this.append(this.childView),this},createChildView:function(e){var r=t.extend({config:this.config,query:this.query,model:this.model},n.base.getValue(e,"options"));return new e.ctor(r)}});p.Factory=n.factory.buildFactory(p);var d=n.view.View.extend({tagName:"th",defaultTemplate:a,events:{click:"onClick"},initialize:function(e){e=t.extend(e,{template:this.defaultTemplate},e),this.template=t.template(e.template),this.config=e.config,this.context=e.context,this.sort=e.sort,this.query=e.query,this.orderByCollection=this.query.state.orderBys(),this.sortDirection=this.determineSortDirection(),this.sort&&this.listenTo(this.orderByCollection,"reset",this.render)},classes:function(){var e=["grid-header-cell","grid-header-cell-"+this.config.key];return this.sort&&e.push("grid-header-cell-sort"),this.sortDirection&&e.push("grid-header-cell-sort-"+this.sortDirection.toLowerCase()),e},render:function(){this.sortDirection=this.determineSortDirection();var e=t.extend({column:this.config.column,sortDirection:this.sortDirection},n.base.getValue(this,"context",this));return this.$el.html(this.template(e)),this.$el.attr("class",this.classes().join(" ")),this},determineSortDirection:function(){var e,t=this.orderByCollection.where({value:this.sort});return t.length?e=t[0].direction():e=null,e},onClick:function(e){var t,n;this.sort&&(n=this.sortDirection==="ASC"?"DESC":"ASC",t=new r.query.ApiQueryOrderBy({value:this.sort,direction:n}),this.triggerEvent(h.GRID_SORT,{orderByModel:t}))}});d.Factory=n.factory.buildFactory(d);var v=n.view.View.extend({tagName:"tr",attributes:{"class":"grid-header-row"},events:{},initialize:function(e){e=t.extend({template:""},e),this.template=t.template(e.template),this.context=e.context,this.config=e.config,this.query=e.query,this.childViews=[],this.initChildViews()},initChildViews:function(){this.destroyChildViews(),t.each(this.config,this.createCellView,this)},render:function(){var e=t.extend({},n.base.getValue(this,"context",this));return this.$el.html(this.template(e)),t.each(this.childViews,function(e){this.append(e)},this),this},createCellView:function(e){var n=t.extend({},e);n.headerCellView=n.headerCellView||new d.Factory;var r=n.headerCellView.create({config:n,query:this.query});this.childViews.push(r)}});v.Factory=n.factory.buildFactory(v);var m=n.view.View.extend({tagName:"td",defaultTemplate:f,events:{mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},childViews:function(){return[this.hoverView]},initialize:function(e){e=t.extend({template:this.defaultTemplate},e),this.template=t.template(e.template),this.context=e.context,this.config=e.config,this.model=e.model,this.query=e.query,this.valueAttribute=e.valueAttribute,this.value=e.value,this.hoverTimer=null,this.hoverView=null},classes:function(){return["grid-cell","grid-cell-"+this.config.key]},defaultContext:function(){var e,n=this.model,r,i={value:this.value};return this.valueAttribute&&(r=this.valueAttribute.split("__"),t.each(t.initial(r),function(e){var t="get_"+e;n=n[t]()}),e="get_"+t.last(r),i.value=n[e]()),i},render:function(){var e=this.defaultContext(),r=t.extend(e,n.base.getValue(this,"context",e));return this.$el.html(this.template(r)),this.$el.attr("class",this.classes().join(" ")),this},openHoverView:function(){var e;this.config.hoverView&&!this.hoverView&&(e=this.config.hoverView.create({config:this.config,model:this.model,query:this.query}),this.hoverView=new i.DropView({view:e}),this.append(this.hoverView)),this.hoverView&&this.hoverView.open()},onMouseEnter:function(e){this.config.hoverView&&!this.hoverTimer&&(this.hoverTimer=setTimeout(t.bind(this.openHoverView,this),1e3))},onMouseLeave:function(e){this.hoverTimer&&(clearTimeout(this.hoverTimer),this.hoverTimer=null),this.hoverView&&this.hoverView.close()}});m.Factory=n.factory.buildFactory(m);var g=m.extend({initialize:function(e){e=t.extend({template:l,context:{href:e.href}},e),m.prototype.initialize.call(this,e)},classes:function(){var e=m.prototype.classes.call(this);return e.push("grid-link-cell"),e}});g.Factory=n.factory.buildFactory(g);var y=m.extend({initialize:function(e){var r=e.format||"MM/dd/yy",i=function(e){return{value:n.format.date(e.value,r)}};e=t.extend({context:i},e),m.prototype.initialize.call(this,e)},classes:function(){var e=m.prototype.classes.call(this);return e.push("grid-date-cell"),e}});y.Factory=n.factory.buildFactory(y);var b=m.extend({defaultTemplate:c,events:{"click button":"onToggle",mouseleave:"onMouseLeave","select .menu":"onDropMenuSelect"},childViews:function(){return[this.childView]},initialize:function(e){e=t.extend({template:this.defaultTemplate},e),m.prototype.initialize.call(this,e),this.menuItemsAdapter=new n.adapt.ModelCollectionAdapter({events:this,map:e.map,model:this.model,adaptedCollection:new s.MenuItemCollection}),this.childView=this.createChildView()},classes:function(){var e=m.prototype.classes.call(this);return e.push("grid-action-cell"),e},render:function(){return m.prototype.render.call(this),this.append(this.childView),this},createChildView:function(){var e=this.menuItemsAdapter.adaptedCollection;return new o.DropMenuView({collection:e})},onToggle:function(e){this.childView.toggle()},onMouseLeave:function(e){this.childView.close()},onDropMenuSelect:function(e,t){var n={menuItem:t.model,model:this.model,query:this.query};e.stopPropagation(),this.childView.close(),this.triggerEvent(h.GRID_ACTION,n)}});b.Factory=n.factory.buildFactory(b);var w=m.extend({initialize:function(e){this.viewFactory=e.viewFactory,m.prototype.initialize.call(this,e),this.view=this.viewFactory.create({config:e.config,model:e.model,query:e.query})},childViews:function(){var e=m.prototype.childViews.call(this);e.push(this.view)},render:function(){return this.$el.html(),this.$el.attr("class",this.classes().join(" ")),this.append(this.view),this}});w.Factory=n.factory.buildFactory(w);var E=n.view.View.extend({tagName:"tr",events:{click:"onRowClick"},initialize:function(e){e=t.extend({template:""},e),this.template=t.template(e.template),this.context=e.context,this.config=e.config,this.model=e.model,this.query=e.query,this.listenTo(this.model,"change",this.render),this.childViews=[],this.initChildViews()},initChildViews:function(){this.destroyChildViews(),t.each(this.config,this.createCellView,this)},classes:function(){return["grid-row"]},render:function(){var e=n.base.getValue(this,"context",this);return this.$el.html(this.template(e)),this.$el.attr("class",this.classes().join(" ")),t.each(this.childViews,function(e){this.append(e)},this),this},createCellView:function(e){var n=t.extend({},e);n.cellView=n.cellView||new m.Factory;var r=n.cellView.create({config:n,model:this.model,query:this.query});return this.childViews.push(r),r},onRowClick:function(e){}});E.Factory=n.factory.buildFactory(E);var S=n.view.View.extend({defaultTemplate:u,events:{GRID_ACTION_EVENT:"onGridAction",GRID_SORT_EVENT:"onGridSort"},childViews:function(){return this.rowViews.concat([this.headerRowView])},initialize:function(e){e=t.extend({template:this.defaultTemplate,context:{}},e),this.template=t.template(e.template),this.context=e.context,this.config=this._normalizeConfig(e.config),this.collection=e.collection,this.query=e.query||this.collection.query(),this.listenTo(this.collection,"reset",this.onReset),this.listenTo(this.collection,"add",this.onAdd),this.listenTo(this.collection,"remove",this.onRemove),this.headerRowView=null,this.rowViews=[],this.initChildViews()},initChildViews:function(){this.destroyChildViews(),this.headerRowView=this.createHeaderRow(),this.rowViews=[],this.collection.each(this.createRow,this)},classes:function(){return["grid"]},render:function(){var e=n.base.getValue(this,"context",this);return this.$el.html(this.template(e)),this.$el.attr("class",this.classes().join(" ")),this.html(this.headerRowView,"thead"),t.each(this.rowViews,function(e){this.append(e,"tbody")},this),this},createHeaderRow:function(){var e=t.extend({},this.config);e.headerRowView=e.headerRowView||new v.Factory;var n=e.headerRowView.create({config:e.columns,query:this.query});return n},createRow:function(e){var n=t.extend({},this.config);n.rowView=n.rowView||new E.Factory;var r=n.rowView.create({config:n.columns,model:e,query:this.query});return this.rowViews.push(r),r},onReset:function(){this.initChildViews(),this.render()},onAdd:function(e){var t=this.createRow(e);this.append(t,"tbody")},onRemove:function(e){this.initChildViews(),this.render()},onGridAction:function(e,t){},onGridSort:function(e,t){var n=20,r=t.orderByModel,i=this.query.state.slice();i&&(n=i.end()-i.start()),this.query.slice(0,n),this.query.state.orderBys().reset([r]),this.query.fetch()},_normalizeConfig:function(e){return t.each(e.columns,function(e){var t;e.column&&!e.key&&(t=e.column.toLowerCase().replace(" ","-"),e.key=t)},this),e}});return{EVENTS:h,GridView:S,GridHeaderRowView:v,GridHeaderCellView:d,GridRowView:E,GridCellView:m,GridDateCellView:y,GridLinkCellView:g,GridActionCellView:b,GridFactoryCellView:w}}),function(e,t,n){function o(e,n){var r=t.createElement(e||"div"),i;for(i in n)r[i]=n[i];return r}function u(e){for(var t=1,n=arguments.length;t<n;t++)e.appendChild(arguments[t]);return e}function f(e,t,n,r){var o=["opacity",t,~~(e*100),n,r].join("-"),u=.01+n/r*100,f=Math.max(1-(1-e)/t*(100-u),e),l=s.substring(0,s.indexOf("Animation")).toLowerCase(),c=l&&"-"+l+"-"||"";return i[o]||(a.insertRule("@"+c+"keyframes "+o+"{"+"0%{opacity:"+f+"}"+u+"%{opacity:"+e+"}"+(u+.01)+"%{opacity:1}"+(u+t)%100+"%{opacity:"+e+"}"+"100%{opacity:"+f+"}"+"}",0),i[o]=1),o}function l(e,t){var i=e.style,s,o;if(i[t]!==n)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(o=0;o<r.length;o++){s=r[o]+t;if(i[s]!==n)return s}}function c(e,t){for(var n in t)e.style[l(e,n)||n]=t[n];return e}function h(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)e[i]===n&&(e[i]=r[i])}return e}function p(e){var t={x:e.offsetLeft,y:e.offsetTop};while(e=e.offsetParent)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}var r=["webkit","Moz","ms","O"],i={},s,a=function(){var e=o("style");return u(t.getElementsByTagName("head")[0],e),e.sheet||e.styleSheet}(),d={lines:12,length:7,width:5,radius:10,rotate:0,color:"#000",speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto"},v=function m(e){if(!this.spin)return new m(e);this.opts=h(e||{},m.defaults,d)};v.defaults={},h(v.prototype,{spin:function(e){this.stop();var t=this,n=t.opts,r=t.el=c(o(0,{className:n.className}),{position:"relative",zIndex:n.zIndex}),i=n.radius+n.length+n.width,u,a;e&&(e.insertBefore(r,e.firstChild||null),a=p(e),u=p(r),c(r,{left:(n.left=="auto"?a.x-u.x+(e.offsetWidth>>1):n.left+i)+"px",top:(n.top=="auto"?a.y-u.y+(e.offsetHeight>>1):n.top+i)+"px"})),r.setAttribute("aria-role","progressbar"),t.lines(r,t.opts);if(!s){var f=0,l=n.fps,h=l/n.speed,d=(1-n.opacity)/(h*n.trail/100),v=h/n.lines;!function m(){f++;for(var e=n.lines;e;e--){var i=Math.max(1-(f+e*v)%h*d,n.opacity);t.opacity(r,n.lines-e,i,n)}t.timeout=t.el&&setTimeout(m,~~(1e3/l))}()}return t},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=n),this},lines:function(e,t){function i(e,r){return c(o(),{position:"absolute",width:t.length+t.width+"px",height:t.width+"px",background:e,boxShadow:r,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*n+t.rotate)+"deg) translate("+t.radius+"px"+",0)",borderRadius:(t.width>>1)+"px"})}var n=0,r;for(;n<t.lines;n++)r=c(o(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:s&&f(t.opacity,t.trail,n,t.lines)+" "+1/t.speed+"s linear infinite"}),t.shadow&&u(r,c(i("#000","0 0 4px #000"),{top:"2px"})),u(e,u(r,i(t.color,"0 0 1px rgba(0,0,0,.1)")));return e},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}}),!function(){function e(e,t){return o("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',t)}var t=c(o("group"),{behavior:"url(#default#VML)"});!l(t,"transform")&&t.adj?(a.addRule(".spin-vml","behavior:url(#default#VML)"),v.prototype.lines=function(t,n){function s(){return c(e("group",{coordsize:i+" "+i,coordorigin:-r+" "+ -r}),{width:i,height:i})}function l(t,i,o){u(a,u(c(s(),{rotation:360/n.lines*t+"deg",left:~~i}),u(c(e("roundrect",{arcsize:1}),{width:r,height:n.width,left:n.radius,top:-n.width>>1,filter:o}),e("fill",{color:n.color,opacity:n.opacity}),e("stroke",{opacity:0}))))}var r=n.length+n.width,i=2*r,o=-(n.width+n.length)*2+"px",a=c(s(),{position:"absolute",top:o,left:o}),f;if(n.shadow)for(f=1;f<=n.lines;f++)l(f,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(f=1;f<=n.lines;f++)l(f);return u(t,a)},v.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}):s=l(t,"animation")}(),e.Spinner=v}(window,document),define("spin",function(e){return function(){var t,n;return t||e.Spinner}}(this)),define("ui/spinner/views",["jquery","underscore","core","spin"],function(e,t,n,r){var i=n.view.View.extend({initialize:function(e){e=t.extend({lines:11,length:5,width:3,radius:6,color:"#000000",speed:1,trail:60,shadow:!1,top:"auto",left:"auto"},e),this.spinner=new r({lines:e.lines,length:e.length,width:e.width,radius:e.radius,color:e.color,speed:e.speed,trail:e.trail,shadow:e.shadow,top:e.top,left:e.left})},destroy:function(){return this.spinner&&this.spinner.stop(),n.view.View.prototype.destroy.apply(this,arguments)},spin:function(e){e=e||this.el,this.spinner.spin(e)},stop:function(){this.spinner.stop()},render:function(){return this.$el.html(),this}});return{SpinnerView:i}}),define("ui/load/views",["jquery","underscore","core","../spinner/views"],function(e,t,n,r,i){var s=n.view.View.extend({events:{},initialize:function(e){e=t.extend({lines:11,length:5,width:3,radius:6,color:"#000000",speed:1,trail:60,shadow:!1,top:"auto",left:"auto"},e),this.loader=e.loader,this.spinnerView=new i.SpinnerView({lines:e.lines,length:e.length,width:e.width,radius:e.radius,color:e.color,speed:e.speed,trail:e.trail,shadow:e.shadow,top:e.top,left:e.left}),e.loader&&(this.listenTo(this.loader,"loading",this.spin),this.listenTo(this.loader,"loaded",this.stop))},childViews:function(){return[this.spinnerView]},destroy:function(){return this.spinner&&this.spinner.stop(),n.view.View.prototype.destroy.apply(this,arguments)},spin:function(){this.spinnerView.spin(this.el)},stop:function(){this.spinnerView.stop()},classes:function(){return["loader"]},render:function(){return this.$el.html(),this.$el.attr("class",this.classes().join(" ")),this.append(this.spinnerView),this.loader.isLoading()&&this.spin(),this}});return{LoaderView:s}}),define("text!ui/modal/templates/modal.html",[],function(){return'<div class="modal">\n    <div class="modal-header">\n        <% if(showClose) { %>\n        <button class="close" type="button">x</button>\n        <% } %>\n        <h3><%= title %></h3>\n    </div>\n    <div class="modal-body">\n        <div class="content"></div>\n    </div>\n    <div class="modal-footer">\n        <% if(showAction) { %>\n        <button class="btn btn-primary action" type="button"><%= action %></button>\n        <% } %>\n\n        <% if(showSave) { %>\n        <button class="btn btn-primary save" type="button">Save</button>\n        <% } %>\n\n        <% if(showOk) { %>\n        <button class="btn btn-primary ok" type="button">Ok</button>\n        <% } %>\n\n        <% if(showCancel) { %>\n        <button class="btn cancel" type="button">Cancel</button>\n        <% } %>\n    </div>\n</div>\n'}),define("ui/modal/views",["jquery","jquery.bootstrap","underscore","core","text!./templates/modal.html"],function(e,t,n,r,i){var s={CLOSE:"close",OK:"ok",SAVE:"save",ACTION:"action",CANCEL:"cancel"},o=r.view.View.extend({events:{"click .close":"onClose","click .ok":"onOk","click .save":"onSave","click .cancel":"onCancel","click .action":"onAction"},initialize:function(e){e=n.extend({autoDestroy:!0,exitOnBackdropClick:!0,exitOnEscapeKey:!0},e),this.template=n.template(i),this.viewOrFactory=e.viewOrFactory,this.title=e.title,this.autoDestroy=e.autoDestroy,this.exitOnBackdropClick=e.exitOnBackdropClick,this.exitOnEscapeKey=e.exitOnEscapeKey,this.ok=e.ok,this.save=e.save,this.cancel=e.cancel,this.close=e.close,this.action=e.action,this.view=null,this.initChildViews()},initChildViews:function(){this.viewOrFactory instanceof r.factory.Factory?this.view=this.viewOrFactory.create():this.view=this.viewOrFactory},childViews:function(){return[this.view]},context:function(){return{title:this.title,action:this.view.action,showClose:n.isFunction(this.view.onClose),showCancel:n.isFunction(this.view.onCancel),showOk:n.isFunction(this.view.onOk),showSave:n.isFunction(this.view.onSave),showAction:n.isFunction(this.view.onAction)}},render:function(){var e=this.context();return this.$el.html(this.template(e)),this.append(this.view,".content"),this.$el.modal({backdrop:this.exitOnBackdropClick?!0:"static",keyboard:this.exitOnEscapeKey?!0:!1,show:!0}),this},isModal:function(){return!0},show:function(){this.$el.modal("show")},hide:function(){this.$el.modal("hide")},onClose:function(){this.view.onClose()&&(this.hide(),this.triggerEvent(s.CLOSE),n.isFunction(this.close)&&this.close(),this.autoDestroy&&this.destroy())},onOk:function(){this.view.onOk()&&(this.hide(),this.triggerEvent(s.OK),n.isFunction(this.ok)&&this.ok(),this.autoDestroy&&this.destroy())},onSave:function(){this.view.onSave()&&(this.hide(),this.triggerEvent(s.SAVE),n.isFunction(this.save)&&this.save(),this.autoDestroy&&this.destroy())},onAction:function(){this.view.onAction()&&(this.hide(),this.triggerEvent(s.ACTION),n.isFunction(this.action)&&this.action(),this.autoDestroy&&this.destroy())},onCancel:function(){this.view.onCancel()&&(this.hide(),this.triggerEvent(s.CANCEL),n.isFunction(this.cancel)&&this.cancel(),this.autoDestroy&&this.destroy())}});return{EventType:s,ModalView:o}}),define("text!ui/paginator/templates/paginator.html",[],function(){return'<% if(stats.totalPages > 1) { %>\n<div class="pagination">\n    <ul>\n        <% _.each(pages, function(page) { %>\n        <li class="<%= page.disabled ? \'disabled\' : \'\' %> <%= page.page === stats.currentPage ? \'active\' : \'\' %>">\n            <a class="paginator-page" data-page="<%= page.page %>" href="javascript:void(0)"><%= page.label %></a>\n        </li>\n        <% }); %>\n    </ul>\n</div>\n<% } %>\n'}),define("ui/paginator/views",["jquery","underscore","core","text!./templates/paginator.html"],function(e,t,n,r){var i={},s=n.view.View.extend({defaultTemplate:r,events:{"click .paginator-page":"onPage"},initialize:function(e){e=t.extend({prevLabel:"Prev",nextLabel:"Next",maxPages:5,template:this.defaultTemplate},e),this.prevLabel=e.prevLabel,this.nextLabel=e.nextLabel,this.maxPages=e.maxPages,this.template=t.template(e.template),this.context=e.context,this.collection=e.collection,this.query=e.query,this.listenTo(this.collection,"reset",this.render)},classes:function(){return["paginator"]},stats:function(){var e=0,t=0,n=20,r=0,i=0,s=0,o=this.query.state.slice();return this.collection.isLoaded()&&(o?(n=o.end()-o.start(),n===0&&(n=1),r=Math.ceil(o.end()/n)):(n=20,r=1),s=this.collection.meta.total_count,s&&(i=Math.ceil(s/n)),this.collection.length&&(e=(r-1)*n+1,t=(r-1)*n+this.collection.length)),{pageSize:n,currentPage:r,totalPages:i,totalCount:s,start:e,end:t,length:this.collection.length}},pages:function(){var e=[],t=this.stats(),n,r,i;t.totalPages-t.currentPage>Math.floor(this.maxPages/2)?(r=Math.max(t.currentPage-Math.floor(this.maxPages/2),1),i=Math.min(r+this.maxPages-1,t.totalPages)):(i=t.totalPages,r=Math.max(t.totalPages-this.maxPages+1,1)),e.push({label:this.prevLabel,page:t.currentPage>1?t.currentPage-1:r,disabled:t.currentPage<=1});for(n=r;n<=i;n++)e.push({label:n.toString(),page:n,disabled:!1});return e.push({label:this.nextLabel,page:t.currentPage<t.totalPages?t.currentPage+1:i,disabled:t.currentPage>=t.totalPages}),e},render:function(){var e=t.extend({stats:this.stats(),pages:this.pages()},n.base.getValue(this,"context",this));return this.destroyChildViews(),this.$el.html(this.template(e)),this.$el.attr("class",this.classes().join(" ")),this},next:function(){var e=this.stats();e.currentPage!==e.totalPages&&(this.query.slice(e.start+e.pageSize-1,e.end+e.pageSize),this.query.fetch())},prev:function(){var e=this.stats();e.currentPage>1&&(this.query.slice(e.start-e.pageSize-1,e.end-e.pageSize),this.query.fetch())},page:function(e){var t,n,r=this.stats();e!==r.currentPage&&e>=1&&e<=r.totalPages&&(t=(e-1)*r.pageSize,n=t+r.pageSize,this.query.slice(t,n),this.query.fetch())},onPage:function(t){var n=e(t.currentTarget),r=n.data("page");this.page(r)}});return{EVENTS:i,PaginatorView:s}}),define("text!ui/rating/stars/templates/ratingstars.html",[],function(){return'<% if(label) { %>\n<div class="rating-star-label"><%= label %></div>\n<% } %>\n\n<div class="rating-stars">\n    <% if(!readonly) { %>\n    <div class="clear-rating"><i class="icon-ban-circle"></i></div>\n    <% } %>\n\n    <% _.each(stars, function(star) { %><div class="rating-star">\n    <% if (star.lit) { %>\n    <div class="rating-star-background" style="width: 100%;"></div>\n    <div class="rating-star-background rating-star-on <%= star.starID %>" style="width:<%= star.percentage %>%;"></div>\n    <div class="rating-star-image"></div>\n    <% } else { %>\n    <div class="rating-star-background <%= star.starID %>" style="width: 100%;"></div>\n    <div class="rating-star-image"></div>\n    <% } %></div><% }); %>\n</div>\n'}),define("ui/rating/stars/views",["jquery","underscore","jquery.bootstrap","core","../../events/type","text!./templates/ratingstars.html"],function(e,t,n,r,i,s){var o={CHANGE:i.CHANGE},u=r.view.View.extend({allStarsSelector:".rating-stars > .rating-star",starOnClass:"rating-star-on",starHoverClass:"rating-star-hover",starBackgroundColorClass:".rating-star-background",events:{"mouseover .rating-star":"onMouseover","mouseout .rating-star":"onMouseout","click .rating-star":"onClick","click .clear-rating":"onClear"},initialize:function(e){e=t.extend({label:"",model:null,attribute:null,totalStars:5,readonly:!1},e),this.label=e.label,this.model=e.model,this.attribute=e.attribute,this.totalStars=e.totalStars,this.readonly=e.readonly,this.template=t.template(s),this.model||(this.model=new Backbone.Model({rating:null}),this.attribute="rating",this.setRating(0)),this.listenTo(this.model,"change:"+this.attribute,this.onChange)},getRating:function(){return this.model.get(this.attribute)},setRating:function(e){return this.model.set(this.attribute,e),this},render:function(){var e=[],t=this.getRating(),n=null,r=null,i=null,s=null;for(n=1;n<=this.totalStars;n++)r=!1,i=0,t&&(s=n-t,n<=t&&(r=!0,i=100),s>0&&s<1&&(r=!0,i=t%1*100)),e.push({starID:"star"+n,lit:r,percentage:i});var o={label:this.label,stars:e,readonly:this.readonly};return this.$el.html(this.template(o)),this},onChange:function(){this.render()},onMouseover:function(e){if(this.readonly)return;var t=this.$(e.currentTarget);this._drainFill(),this._hoverFill(t)},onMouseout:function(e){if(this.readonly)return;this._drainFill(),this.render()},onClick:function(e){if(this.readonly)return;var t=this.$(e.currentTarget),n=this._determineRating(t);this.setRating(n),this.render(),this.triggerEvent(o.CHANGE,{value:n})},onClear:function(e){if(this.readonly)return;this.setRating(0),this.render(),this.triggerEvent(o.CHANGE,{value:0})},_drainFill:function(){this.$(this.allStarsSelector).children().filter(this.starBackgroundColorClass).removeClass(this.starOnClass).removeClass(this.starHoverClass).css({width:"100%"})},_hoverFill:function(e){e.children().filter(this.starBackgroundColorClass).addClass(this.starHoverClass),e.prevAll().children().filter(this.starBackgroundColorClass).addClass(this.starHoverClass)},_determineRating:function(e){var t=0,n=null;for(n=1;n<=this.totalStars;n++)if(e.children().hasClass("star"+n)){t=n;break}return t}});return{EventType:o,RatingStarsView:u}}),define("ui/main",["./ac/inputhandler","./ac/matcher","./ac/views","./collection/views","./date/views","./drop/views","./facet/views","./filter/models","./filter/views","./grid/views","./input/views","./load/views","./menu/models","./menu/views","./modal/views","./paginator/views","./rating/stars/views","./select/models","./select/views","./spinner/views","./template/views"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w){return{ac:{inputhandler:e,matcher:t,views:n},collection:{views:r},date:{views:i},drop:{views:s},facet:{views:o},filter:{model:u,views:a},grid:{views:f},input:{views:l},load:{views:c},menu:{models:h,views:p},modal:{views:d},paginator:{views:v},rating:{stars:{views:m}},select:{models:g,views:y},spinner:{views:b},template:{views:w}}}),define("ui",["ui/main"],function(e){return e}),define("text!user/templates/user.html",[],function(){return'<div class="container">\n    <div class="row ">\n        <div class="span8">\n            <div class="row">\n                <div id="user-job-prefs"></div>\n            </div>\n            <div class="row">\n                <div id="user-skills"></div>\n            </div>\n            <div class="row">\n                <div id="user-chats"></div>\n            </div>\n        </div>\n        <div class="span4 no-span-margin">\n            <div id="user-actions"></div>\n        </div>\n    </div>\n</div>\n\n\n\n'}),define("text!user/templates/jobprefs.html",[],function(){return'<div class="span7">\n    <h3 class="user-section-border-bottom">User Profile <span rel="tooltip" title="Anonymous user ID" class="orange-text normal-font">{<%= model.id %>}</span></h3>\n</div>\n<div class="span8 user-position-prefs-container">\n\n    <div class="span2-5">\n        <p>Seeking position types</p>\n        <div class="well">\n            <ul class="position-prefs unstyled">\n                <% if (!model.position_prefs.length) { %>\n                <span><em>No jobs provided</em></span>\n                <% } else { %>\n\n                <% _.each(model.position_prefs, function(position) { %>\n                <li><%= position.type %> <em><%= position.salary_start ? fmt.num(position.salary_start/1000, \'cn0\')+\'k\' : \'\' %></em></li>\n                <% }); %>\n\n                <% if (model.position_prefs.length > 3) { %>\n                <a class="slide-toggle">more</a>\n                <% } %>\n\n                <% } %>\n            </ul>\n        </div>\n    </div>\n\n    <div class="span2-5">\n        <p>In these locations</p>\n        <div class="well">\n            <ul class="location-prefs unstyled">\n                <% if (!model.location_prefs.length) { %>\n                <span><em>No locations provided</em></span>\n                <% } else { %>\n\n                <% _.each(model.location_prefs, function(location) { %>\n                <% if(location.city) { %>\n                <li><%= location.city %>, <%= location.state %></li>\n                <% } else { %>\n                <li><%= location.state %></li>\n                <% } %>\n                <% }); %>\n\n                <% if (model.location_prefs.length > 3) { %>\n                <a class="slide-toggle">more</a>\n                <% } %>\n\n                <% } %>\n            </ul>\n        </div>\n    </div>\n\n    <div class="span2-5">\n        <p>With these technologies</p>\n        <div class="well">\n            <ul class="technology-prefs unstyled">\n                <% if (!sortedTechPrefs.length) { %>\n                <span><em>No technologies provided</em></span>\n                <% } else { %>\n\n                <% _.each(sortedTechPrefs, function(technology) { %>\n                <li><%= technology.name %></li>\n                <% }); %>\n\n                <% if (sortedTechPrefs.length > 3) { %>\n                <a class="slide-toggle">more</a>\n                <% } %>\n\n                <% } %>\n            </ul>\n        </div>\n    </div>\n\n</div>'}),define("text!user/templates/skills.html",[],function(){return'<div class="span7">\n    <h3 class="user-section-border-bottom">Skills\n        <small>\n            <div class="user-skills-legend">\n                <div class="expert">Expert</div>\n                <div class="proficient">Proficient</div>\n                <div class="novice">Novice</div>\n            </div>\n        </small>\n    </h3>\n</div>\n<div class="span8 user-skills-list-container">\n    <% if (!expertCount && !proficientCount && !noviceCount) { %>\n    <span><em>No skills provided</em></span>\n    <% } %>\n    <div id="expert-skills" class="user-skills-container user-skills-expert"></div>\n    <div id="proficient-skills" class="user-skills-container user-skills-proficient"></div>\n    <div id="novice-skills" class="user-skills-container user-skills-novice"></div>\n</div>'}),define("text!user/templates/skill.html",[],function(){return'<span rel="tooltip" title="<%= model.yrs_experience%> yrs experience"><%= model.technology.name %><span class="user-skill-years-text"> (<%= model.yrs_experience %>)</span></span>'}),define("text!user/templates/chats.html",[],function(){return'<div class="span7">\n    <h3 class="user-section-border-bottom">Chats</h3>\n</div>\n<div class="span8">\n    <% if (!collection.length) { %>\n        <span><em>User has not participated in any chats</em></span>\n    <% } else { %>\n        <div id="chat-sessions"></div>\n    <% } %>\n</div>\n\n\n\n'}),define("text!user/templates/chat.html",[],function(){return'<div>\n    <% if(model.chat.topic && model.chat.topic.title) { %>\n\n        <% if(playing) { %>\n        <a><i class="player-btn player-speaker"></i></a>\n        <% } else { %>\n        <a class="play"><i class="player-btn player-play"></i></a>\n        <% } %>\n\n        <a class="chat-title" href="/e/playback/<%=model.id%>"><%= model.chat.topic.title %></a>\n\n        <% if(duration < 60) { %>\n            <span class="chat-title-small">(1 min, </span>\n        <% } else { %>\n            <span class="chat-title-small">(<%= fmt.format(duration / 60, \'n0\') %> min, </span>\n        <% } %>\n        <span class="chat-title-small"><%= model.participants%> participant<%= model.participants > 1 ? \'s\': \'\'%>)</span>\n        <span class="chat-title-small"> </span>\n        <span class="chat-title-small"> on <%= fmt.date(model.start, \'MM/dd/yy\')%></span>\n\n    <% } %>\n</div>\n'}),define("text!user/templates/actions.html",[],function(){return'<div class="user-actions-container user-section-border-left">\n    <h3 class="user-section-border-bottom">Your Notes</h3>\n    <div class="user-note"></div>\n    <h3 class="user-section-border-bottom">Your Evaluations</h3>\n    <div class="application-create-container"></div>\n    <div class="application-briefs"></div>\n</div>'}),define("text!user/templates/note.html",[],function(){return'<div class="user-note-container">\n    <% if (!model) { %>\n    <span><em>Loading notes...</em></span>\n    <% } else { %>\n    <textarea class="input-xlarge user-note-input" name="note" rows="5" placeholder="Your notes" maxlength="1024"><%= model.note %></textarea>\n    <span class="user-note-save-status"></span>\n    <% } %>\n</div>'}),define("text!user/templates/application_brief.html",[],function(){return'<div class="app-brief-container well">\n    <a href="/e/application/<%= model.id %>"><%= req_name %></a>\n    <div class="ratings-container">\n        <div class="rating-culture-container"></div>\n        <div class="rating-technical-container"></div>\n        <div class="rating-communication-container"></div>\n    </div>\n    <div class="ratings-decision-container">\n        <div class="rating-bracket orange-text">}</div>\n        <div class="vote-buttons-container">\n            <div class="vote-decision-text">Vote</div>\n        </div>\n    </div>\n</div>\n'}),define("text!user/templates/application_create.html",[],function(){return'<button type="button" rel="tooltip" title="Track user for open requisitions" class="btn btn-primary drop-button">Track User <span class="caret"></span></button>\n'}),define("text!user/templates/requisition_select.html",[],function(){return'<h5>Track for Requisitions</h5>\n<div class="autoselectview"></div>\n<div class="pull-right">\n    <button type="button" class="btn btn-small btn-primary save">Done</button>\n    <button type="button" class="btn btn-small cancel">Close</button>\n</div>'}),define("text!user/templates/vote_buttons.html",[],function(){return'<span class="btn-group" data-toggle="buttons-radio">\n        <button type="button" class="btn btn-small yes-vote <%= toggled === true ? \'active btn-success\' : \'\'%>">Yes</button>\n        <button type="button" class="btn btn-small no-vote <%= toggled === false ? \'active btn-danger\' : \'\'%>">No</button>\n</span>'}),define("user/views",["jquery","underscore","jquery.bootstrap","core","api","ui","events","text!./templates/user.html","text!./templates/jobprefs.html","text!./templates/skills.html","text!./templates/skill.html","text!./templates/chats.html","text!./templates/chat.html","text!./templates/actions.html","text!./templates/note.html","text!./templates/application_brief.html","text!./templates/application_create.html","text!./templates/requisition_select.html","text!./templates/vote_buttons.html"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){var b={PLAY_CHAT:"user:playChat"},w=r.view.View.extend({positionPrefsSelector:".position-prefs",locationPrefsSelector:".location-prefs",technologyPrefsSelector:".technology-prefs",expandableItemsSelector:".expandable-list-items",slideToggleSelector:".slide-toggle",tooltipSelector:"[rel=tooltip]",events:{"click .position-prefs .slide-toggle":"togglePositionPrefs","click .location-prefs .slide-toggle":"toggleLocationPrefs","click .technology-prefs .slide-toggle":"toggleTechnologyPrefs"},initialize:function(e){this.model=e.model,this.template=t.template(a),this.modelWithRelated=["position_prefs","technology_prefs","location_prefs"],this.loader=new i.loader.ApiLoader([{instance:this.model,withRelated:this.modelWithRelated}],{triggerAlways:!0}),this.loader.load({success:t.bind(this.render,this)})},destroy:function(){this.$(this.tooltipSelector).tooltip("hide"),r.view.View.prototype.destroy.apply(this,arguments)},render:function(){var e=this._getSortedJobTechnologyPrefs(),n={model:this.model.toJSON({withRelated:this.modelWithRelated}),sortedTechPrefs:e.toJSON(),fmt:this.fmt};this.$el.html(this.template(n));var r=[this.positionPrefsSelector,this.locationPrefsSelector,this.technologyPrefsSelector];return t.each(r,this.addExpandableStyle,this),this.$(this.tooltipSelector).tooltip(),this},addExpandableStyle:function(t){this.$(t).children("li").each(function(t){var n=3;t>n-1&&(e(this).addClass("expandable-list-items"),e(this).hide())})},togglePositionPrefs:function(){this.toggleExpandedView(this.positionPrefsSelector)},toggleLocationPrefs:function(){this.toggleExpandedView(this.locationPrefsSelector)},toggleTechnologyPrefs:function(){this.toggleExpandedView(this.technologyPrefsSelector)},toggleExpandedView:function(e){var t=200,n=e+" "+this.expandableItemsSelector;this.$(n).slideToggle(t);var r=e+" "+this.slideToggleSelector;this.toggleExpandButtonText(r)},toggleExpandButtonText:function(t){e(t).text()==="more"?e(t).text("less"):e(t).text("more")},_getSortedJobTechnologyPrefs:function(){var e=this.model.get_technology_prefs(),t=new Backbone.Collection;return t.comparator=function(e){return e.get("name")},e.each(function(e){t.add(e)},this),t}}),E=r.view.View.extend({events:{"click .play":"play"},initialize:function(e){this.playerState=e.playerState,this.template=t.template(h),this.modelWithRelated=["chat__topic"],this.listenTo(this.model,"change",this.render),this.listenTo(this.playerState,"change:state",this.render),this.loader=new i.loader.ApiLoader([{instance:this.model,withRelated:this.modelWithRelated}]),this.loader.load()},render:function(){var e=(this.model.get_end()-this.model.get_start())/1e3,t={model:this.model.toJSON({withRelated:this.modelWithRelated}),fmt:this.fmt,playing:this.isPlaying(),duration:e};return this.$el.html(this.template(t)),this},isPlaying:function(){var e=!1,t=this.playerState.chatSession();return t&&t.id===this.model.id&&(e=this.playerState.state()===this.playerState.STATE.PLAYING),e},play:function(e){var t={chatSession:this.model,chatMinute:null};this.triggerEvent(b.PLAY_CHAT,t)}}),S=r.view.View.extend({events:{},chatSessionsSelector:"#chat-sessions",initialize:function(e){this.playerState=e.playerState,this.template=t.template(c),this.collectionWithRelated=["chat_session__chat__topic"],this.listenTo(this.collection,"reset",this.onReset),this.listenTo(this.collection,"add",this.onAdd),this.loader=new i.loader.ApiLoader([{instance:this.collection,withRelated:this.collectionWithRelated}]),this.loader.load(),this.childViews=[],this.initChildViews()},initChildViews:function(){this.destroyChildViews(),this.childViews=[],this.collection.each(this.createChildView,this)},render:function(){var e={collection:this.collection.toJSON({withRelated:this.collectionWithRelated})};return this.$el.html(this.template(e)),t.each(this.childViews,function(e){this.append(e,this.chatSessionsSelector)},this),this},createChildView:function(e){var t=new E({model:e.get_chat_session(),playerState:this.playerState});return this.childViews.push(t),t},onReset:function(){this.initChildViews(),this.render()},onAdd:function(e){var t=this.createChildView(e);this.append(t,this.chatSessionsSelector)}}),x=r.view.View.extend({initialize:function(e){this.template=t.template(l),this.modelWithRelated=["technology"],this.listenTo(this.model,"change",this.render),this.loader=new i.loader.ApiLoader([{instance:this.model,withRelated:this.modelWithRelated}]),this.loader.load()},render:function(){var e={model:this.model.toJSON({withRelated:["technology"]})};return this.$el.html(this.template(e)),this}}),T=r.view.View.extend({events:{},noviceSkillsSelector:"#novice-skills",proficientSkillsSelector:"#proficient-skills",expertSkillsSelector:"#expert-skills",childViews:function(){var e=this.noviceViews.concat(this.proficientViews).concat(this.expertViews);return e},initialize:function(e){this.template=t.template(f),this.collectionWithRelated=["technology"],this.listenTo(this.collection,"reset",this.onReset),this.listenTo(this.collection,"add",this.onAdd),this.loader=new i.loader.ApiLoader([{instance:this.collection,withRelated:this.collectionWithRelated}]),this.loader.load(),this.noviceViews=[],this.proficientViews=[],this.expertViews=[],this.initChildViews()},initChildViews:function(){this.destroyChildViews(),this.noviceViews=[],this.proficientViews=[],this.expertViews=[],this.collection.each(this.createSkillView,this)},render:function(){var e=t.countBy(this.collection.models,function(e){return e.get_expertise()}),n={collection:this.collection.toJSON(),expertCount:e.Expert,proficientCount:e.Proficient,noviceCount:e.Novice};return this.$el.html(this.template(n)),t.each(this.noviceViews,function(e){this.append(e,this.noviceSkillsSelector)},this),t.each(this.proficientViews,function(e){this.append(e,this.proficientSkillsSelector)},this),t.each(this.expertViews,function(e){this.append(e,this.expertSkillsSelector)},this),this.$("[rel=tooltip]").tooltip(),this},createSkillView:function(e){var t=new x({model:e}),n=function(e,t){return r.array.defaultCompare(-e.model.get_yrs_experience(),-t.model.get_yrs_experience())};switch(e.get_expertise()){case"Novice":r.array.binaryInsert(this.noviceViews,t,n);break;case"Proficient":r.array.binaryInsert(this.proficientViews,t,n);break;case"Expert":r.array.binaryInsert(this.expertViews,t,n)}return t},onReset:function(){this.initChildViews(),this.render()},onAdd:function(e){var t=this.createSkillView(e);this.render()}}),N=r.view.View.extend({textareaSelector:".user-note-input",saveStatusSelector:".user-note-save-status",events:{"blur textarea":"onBlur"},SaveStatusEnum:{PENDING:"Saving note...",SAVED:"Saved.",ERROR:"Error saving note."},initialize:function(e){this.candidateModel=e.candidateModel,this.employeeModel=new i.models.User({id:"CURRENT"}),this.model=null,this.saveTimeout=null,this.saveStatus=null,this.template=t.template(d),this.notesCollection=new i.models.JobNoteCollection,this.notesCollection.on("reset",this.onReset,this),this.noteQuery=this.notesCollection.filterBy({candidate_id:this.candidateModel.id,employee_id:this.employeeModel.id,tenant_id:this.employeeModel.get_tenant_id()}),this.noteQuery.fetch()},destroy:function(){this.saveStatus===this.SaveStatusEnum.PENDING&&this._save(),r.view.View.prototype.destroy.apply(this,arguments)},render:function(){var e={model:this.model?this.model.toJSON():null};return this.$el.html(this.template(e)),this},onReset:function(){this.notesCollection.length?(this.model=this.notesCollection.first(),this.saveStatus=this.SaveStatusEnum.SAVED):this.model=new i.models.JobNote({employee_id:this.employeeModel.id,candidate_id:this.candidateModel.id,tenant_id:this.employeeModel.get_tenant_id()}),this.render()},onBlur:function(){var e=this.$(this.textareaSelector).val(),t=!0;this.saveStatus===null&&e.length===0&&(t=!1),this.saveStatus===this.SaveStatusEnum.SAVED&&this.model.get_note()===e&&(t=!1),t&&this._scheduleSave()},updateSaveStatusUI:function(){this.$(this.saveStatusSelector).text(this.saveStatus)},_scheduleSave:function(t){var n=t?t:500;this.saveStatus=this.SaveStatusEnum.PENDING,this.updateSaveStatusUI(),clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(e.proxy(this._save,this),n)},_save:function(){var e=this,n={candidate_id:this.model.get_candidate_id(),note:this.$(this.textareaSelector).val()},r=t.extend({model:this.model,onSuccess:function(){e.saveStatus=e.SaveStatusEnum.SAVED,e.updateSaveStatusUI()}},n);this.triggerEvent(o.TAKE_NOTE,r)}}),C=r.view.View.extend({buttonGroupSelector:".btn-group button",events:{"click .active":"onUnclick",'click button:not([class="active"])':"onClick"},initialize:function(e){this.applicationModel=e.applicationModel,this.employeeModel=new i.models.User({id:"CURRENT"}),this.voteModel=null,this.template=t.template(y),this.appVotesCollection=this.applicationModel.get_application_votes(),this.listenTo(this.appVotesCollection,"reset",this.onReset),this.appVoteQuery=this.appVotesCollection.filterBy({user_id:this.employeeModel.id}),this.appVoteQuery.fetch()},render:function(){var e={toggled:this.voteModel?this.voteModel.get_yes():null};return this.$el.html(this.template(e)),this},onReset:function(){this.appVotesCollection.length?this.voteModel=this.appVotesCollection.first():this.voteModel=new i.models.ApplicationVote({application_id:this.applicationModel.id,yes:null}),this.render()},onClick:function(e){var t=this.$(e.currentTarget);this.select(t),this.addButtonColor(t),this._save(this._determineVoteValue(t))},onUnclick:function(e){var t=this.$(e.currentTarget);this.deselect(t,e),this._save(this._determineVoteValue(t))},addButtonColor:function(e){e.hasClass("yes-vote")?(this.$(this.buttonGroupSelector).removeClass("btn-danger"),e.addClass("btn-success")):e.hasClass("no-vote")&&(this.$(this.buttonGroupSelector).removeClass("btn-success"),e.addClass("btn-danger"))},select:function(e){e.hasClass("active")||e.addClass("active")},deselect:function(e,t){e.hasClass("active")&&(t.stopImmediatePropagation(),this.$(this.buttonGroupSelector).removeClass("btn-success btn-danger"),e.removeClass("active"))},_determineVoteValue:function(e){var t=null;return e.hasClass("active")&&e.hasClass("yes-vote")?t=!0:e.hasClass("active")&&e.hasClass("no-vote")&&(t=!1),t},_save:function(e){var n={yes:e},r=t.extend({model:this.voteModel,application:this.applicationModel},n);this.triggerEvent(o.CAST_APPLICANT_VOTE,r)}}),k=r.view.View.extend({ratingCommunicationSelector:".rating-communication-container",ratingTechnicalSelector:".rating-technical-container",ratingCultureSelector:".rating-culture-container",voteButtonsSelector:".vote-buttons-container",tooltipSelector:"[rel=tooltip]",events:{"change .rating-culture-container":"onCulturalFitScoreChange","change .rating-technical-container":"onTechnicalScoreChange","change .rating-communication-container":"onCommunicationScoreChange"},childViews:function(){return[this.voteButtonsView,this.ratingCommunicationView,this.ratingTechnicalView,this.ratingCultureView]},initialize:function(e){this.model=e.model,this.listenTo(this.model,"change",this.onAppModelChange),this.listenTo(this.model.get_requisition(),"change",this.onReqModelChange),this.employeeModel=new i.models.User({id:"CURRENT"}),this.scoreModel=null,this.template=t.template(v),this.appScoresCollection=this.model.get_application_scores(),this.listenTo(this.appScoresCollection,"reset",this.onAppScoresReset),this.voteButtonsView=null,this.ratingCommunicationView=null,this.ratingTechnicalView=null,this.ratingCultureView=null,this.initChildViews(),this.loader=new i.loader.ApiLoader([{instance:this.model,withRelated:["requisition"]}]),this.loader.load(),this.appScoreQuery=this.appScoresCollection.filterBy({user_id:this.employeeModel.id}),this.appScoreQuery.fetch()},initChildViews:function(){this.voteButtonsView=new C({applicationModel:this.model}),this.ratingCommunicationView=new s.rating.stars.views.RatingStarsView({label:"Comm"}),this.ratingTechnicalView=new s.rating.stars.views.RatingStarsView({label:"Tech"}),this.ratingCultureView=new s.rating.stars.views.RatingStarsView({label:"Fit "})},destroy:function(){this.$(this.tooltipSelector).tooltip("hide"),r.view.View.prototype.destroy.apply(this,arguments)},render:function(){var e=this.model.get_requisition().get_title(),t={model:this.model.toJSON(),req_name:e?e:this.model.get_requisition_id()};return this.$el.html(this.template(t)),this.scoreModel&&(this.ratingCommunicationView.setRating(this.scoreModel.get_communication_score()),this.ratingTechnicalView.setRating(this.scoreModel.get_technical_score()),this.ratingCultureView.setRating(this.scoreModel.get_cultural_fit_score())),this.append(this.voteButtonsView,this.voteButtonsSelector),this.append(this.ratingCommunicationView,this.ratingCommunicationSelector),this.append(this.ratingTechnicalView,this.ratingTechnicalSelector),this.append(this.ratingCultureView,this.ratingCultureSelector),this.$(this.tooltipSelector).tooltip(),this},onAppModelChange:function(){this.render()},onReqModelChange:function(){this.render()},onAppScoresReset:function(){this.appScoresCollection.length?this.scoreModel=this.appScoresCollection.first():this.scoreModel=new i.models.ApplicationScore({application_id:this.model.id,technical_score:0,communication_score:0,cultural_fit_score:0}),this.render()},onCulturalFitScoreChange:function(e,t){this._saveScore({cultural_fit_score:t.value})},onTechnicalScoreChange:function(e,t){this._saveScore({technical_score:t.value})},onCommunicationScoreChange:function(e,t){this._saveScore({communication_score:t.value})},_saveScore:function(e){var n=t.extend({model:this.scoreModel,application:this.model},e);this.triggerEvent(o.SCORE_APPLICANT,n)}}),L=r.view.View.extend({autoSelectViewSelector:".autoselectview",searchInputSelector:"input.search",childViews:function(){return[this.autoSelectView]},initialize:function(e){var n=this;this.applicationsCollection=e.applicationsCollection,this.employeeModel=new i.models.User({id:"CURRENT"}),this.requisitionSelectionCollection=new s.select.models.SelectionCollection,this.template=t.template(g),this.requisitionsQueryFactory=function(e){return(new i.models.RequisitionCollection).filterBy({tenant_id__eq:n.employeeModel.get_tenant_id(),status__eq:"OPEN",title__istartswith:e.search})},this.requisitionsMatcher=new s.ac.matcher.QueryMatcher({queryFactory:new r.factory.FunctionFactory(this.requisitionsQueryFactory),stringify:function(e){return e.get_title()},map:function(e){var t=null;return n.applicationsCollection.where({requisition_id:e.id}).length||(t={id:e.id,value:e.get_title()}),t}}),this.autoSelectView=null,this.initChildViews()},initChildViews:function(){this.autoSelectView=new s.select.views.AutoMultiSelectView({inputPlaceholder:"Search requisition titles",collection:this.requisitionSelectionCollection,matcher:this.requisitionsMatcher,maxResults:5})},render:function(){var e={};return this.$el.html(this.template(e)),this.append(this.autoSelectView,this.autoSelectViewSelector),this}}),A=r.view.View.extend({tooltipSelector:"[rel=tooltip]",events:{"click .drop-button":"onToggle","open .drop":"onDropViewOpened","close .drop":"onDropViewClosed","click .cancel":"onClose","click .save":"onSave"},childViews:function(){return[this.dropView,this.selectView]},initialize:function(e){this.applicationsCollection=e.applicationsCollection,this.candidateModel=e.candidateModel,this.template=t.template(m),this.dropView=null,this.selectView=null,this.initChildViews()},initChildViews:function(){this.selectView=new L({applicationsCollection:this.applicationsCollection}),this.dropView=new s.drop.views.DropView({view:this.selectView})},destroy:function(){this.$(this.tooltipSelector).tooltip("hide"),r.view.View.prototype.destroy.apply(this,arguments)},render:function(){var e={};return this.$el.html(this.template(e)),this.append(this.dropView),this.$(this.tooltipSelector).tooltip(),this},onToggle:function(e){this.dropView.toggle()},onClose:function(e){this.dropView.close()},onSave:function(e){this.selectView.requisitionSelectionCollection.each(this._createApplication,this),this.dropView.close()},onDropViewOpened:function(e){this.dropView.childView.autoSelectView.refresh(),this.dropView.childView.autoSelectView.input().focus()},onDropViewClosed:function(e){this.selectView.requisitionSelectionCollection.reset(),this.$(this.selectView.searchInputSelector).val("")},_createApplication:function(e){if(e.selected()){var t=this,n=new i.models.Application({user_id:this.candidateModel.id,requisition_id:e.id}),r={model:n,onSuccess:function(){t.applicationsCollection.add(n)}};this.triggerEvent(o.CREATE_APPLICATION,r)}}}),O=r.view.View.extend({noteSelector:".user-note",applicationCreateSelector:".application-create-container",applicationBriefsSelector:".application-briefs",childViews:function(){return[this.noteView,this.applicationCreateView,this.applicationBriefsView]},initialize:function(e){this.candidateModel=e.candidateModel,this.employeeModel=new i.models.User({id:"CURRENT"}),this.template=t.template(p),this.applicationsCollection=this.candidateModel.get_applications(),this.applicationsQuery=this.applicationsCollection.filterBy({tenant_id:this.employeeModel.get_tenant_id(),requisition__status:"OPEN"}),this.applicationsQuery.fetch(),this.noteView=null,this.applicationCreateView=null,this.applicationBriefsView=null,this.initChildViews()},initChildViews:function(){this.noteView=new N({candidateModel:this.candidateModel}),this.applicationCreateView=new A({applicationsCollection:this.applicationsCollection,candidateModel:this.candidateModel}),this.applicationBriefsView=new s.collection.views.CollectionView({collection:this.applicationsCollection,viewFactory:new r.factory.Factory(k,{})})},render:function(){var e={candidateModel:this.candidateModel};return this.$el.html(this.template(e)),this.append(this.noteView,this.noteSelector),this.append(this.applicationCreateView,this.applicationCreateSelector),this.append(this.applicationBriefsView,this.applicationBriefsSelector),this}}),M=r.view.View.extend({jobPrefsSelector:"#user-job-prefs",skillsSelector:"#user-skills",chatsSelector:"#user-chats",actionsSelector:"#user-actions",childViews:function(){return[this.jobPrefsView,this.skillsView,this.chatsView,this.actionsView]},initialize:function(e){this.candidateModel=e.candidateModel,this.employeeModel=e.employeeModel,this.playerState=e.playerState,this.template=t.template(u),this.modelWithRelated=["highlight_sessions__chat_session__chat__topic","skills__technology","position_prefs","technology_prefs","location_prefs"],this.listenTo(this.candidateModel,"change",this.render),this.loader=new i.loader.ApiLoader([{instance:this.candidateModel,withRelated:this.modelWithRelated}]),this.loader.load(),this.jobPrefsView=null,this.skillsView=null,this.chatsView=null,this.actionsView=null,this.initChildViews()},initChildViews:function(){this.jobPrefsView=new w({model:this.candidateModel}),this.skillsView=new T({collection:this.candidateModel.get_skills()}),this.chatsView=new S({collection:this.candidateModel.get_highlight_sessions(),playerState:this.playerState}),this.actionsView=new O({candidateModel:this.candidateModel})},render:function(){var e={model:this.candidateModel.toJSON(),fmt:this.fmt};return this.$el.html(this.template(e)),this.assign(this.jobPrefsView,this.jobPrefsSelector),this.assign(this.skillsView,this.skillsSelector),this.assign(this.chatsView,this.chatsSelector),this.assign(this.actionsView,this.actionsSelector),this}});return{EVENTS:b,UserView:M}}),define("user/mediators",["underscore","notifications","core","api","ctrl","player","./views"],function(e,t,n,r,i,s,o){var u=n.mediator.Mediator.extend({name:function(){return u.NAME},viewType:function(){return u.VIEW_TYPE},notifications:[[t.VIEW_CREATE,"onCreateView"],[t.VIEW_DESTROY,"onDestroyView"]],initialize:function(e){this.view=null,this.currentProxy=this.facade.getProxy(i.proxies.current.CurrentProxy.NAME),this.playerStateProxy=this.facade.getProxy(i.proxies.player.PlayerStateProxy.NAME),this.session=new r.session.ApiSession.get},onCreateView:function(e){if(e.type===this.viewType()){var n,i;i=this.currentProxy.currentUser(),n=this.session.getModel(r.models.User.key(e.options.id)),n||(n=new r.models.User({id:e.options.id})),this.view=new o.UserView({candidateModel:n,employeeModel:i,playerState:this.playerStateProxy.model}),this.view.addEventListener(this.cid,o.EVENTS.PLAY_CHAT,this.onPlay,this),this.facade.trigger(t.VIEW_CREATED,{type:this.viewType(),view:this.view,options:e.options})}},onDestroyView:function(e){e.type===this.viewType()&&(e.view.destroy(),this.facade.trigger(t.VIEW_DESTROYED,{type:this.viewType(),view:e.view}),this.view===e.view&&(this.view=null))},onPlay:function(e,n){var r={chatSession:n.chatSession,chatMinute:n.chatMinute};this.facade.trigger(t.PLAYER_PLAY,r)}},{NAME:"UserMediator",VIEW_TYPE:"UserView"});return{UserMediator:u}}),define("user/main",["core","./mediators","./views"],function(e,t,n){var r=function(e){var n=new t.UserMediator;e.registerMediator(n)};return e.facade.register(r),{mediators:t,views:n}}),define("user",["user/main"],function(e){return e});